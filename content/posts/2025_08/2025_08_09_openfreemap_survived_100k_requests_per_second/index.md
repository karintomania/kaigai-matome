+++
date = '2025-08-09T00:00:00'
months = '2025/08'
draft = false
title = 'OpenFreeMap、毎秒10万リクエストの猛攻を耐え抜いた！'
tags = ["Webサービス", "スケーラビリティ", "負荷分散", "パフォーマンス", "GIS"]
featureimage = 'thumbnails/light-orange1.jpg'
+++

> OpenFreeMap、毎秒10万リクエストの猛攻を耐え抜いた！

引用元：[https://news.ycombinator.com/item?id=44846318](https://news.ycombinator.com/item?id=44846318)




{{<matomeQuote body="\u003eスクリプトキッズが画像描いてるって信じてるよ。ウェブサイトは1ピクセル/30秒の制限だけど、みんなPuppeteer/Chromium使って新しいブラウザ立ち上げてピクセル打って閉じてるんだろ。IPアドレスも要らないかもな。お前はこの現象を舐めてるよ。みんな/r/placeみたいに、自分の住んでるとこ描きたがるんだよな。" userName="Starlevel004" createdAt="2025/08/09 17:39:41" color="#ff5c5c">}}




{{<matomeQuote body="1ピクセル/30秒どころか、20ピクセル/30秒くらいだよ。それに“タンク”があって、いくらでも大きくできるんだ。ピクセル置くとポイントもらえて、それをピクセルやタンク拡張に使える。4000ピクセル持ってる人も見たことあるぜ。" userName="indrora" createdAt="2025/08/10 15:51:54" color="#45d325">}}




{{<matomeQuote body="\u003eお前はこの現象を舐めてるよ。記事でサイトに直接聞いて、トラフィック数知ってるんだから、見積もる必要ないだろ。推定200万ユーザーだってよ。ユーザーあたり1500リクエストってことは、相当なスクリプトが動いてるってことだよな。" userName="Aurornis" createdAt="2025/08/10 14:26:46" color="#785bff">}}




{{<matomeQuote body="\u003eお前はこの現象を舐めてるよ。みんな instantly knew って言ってるけど、こっちは初めて聞いたぜ。" userName="zahlman" createdAt="2025/08/10 14:36:26" color="">}}




{{<matomeQuote body="こういうピクセル描画は知ってたけど、それは空のキャンバスの上だったんだよね。" userName="johnisgood" createdAt="2025/08/10 15:21:11" color="">}}




{{<matomeQuote body="開発者から聞いたユーザー数は200万人だろ。毎日200万ユーザーが、一部がbotじゃなきゃ何十億ものリクエストを生み出すはずないよな。" userName="yifanl" createdAt="2025/08/10 14:44:10" color="#38d3d3">}}




{{<matomeQuote body="なんで？これタイルリクエストだろ？ログインじゃない。ユーザーは地図見て動き回るから、数千リクエスト消費するの普通じゃないか？ボットはいるだろうけど、半分近くが“正当”なトラフィックでも驚かないね。ボットはマップタイルを読み込む必要もないしさ。" userName="zamadatix" createdAt="2025/08/10 18:19:14" color="#785bff">}}




{{<matomeQuote body="\u003eスクリプトキッズが描いてる？いや、絶対違うよ。ノライフででっかいアート作ってるアスペルガーの人たちをたくさん見たし。\u003e1500リクエスト/ユーザー。これも違うと思うな。みんなアート見にマップ中を動き回るからね。自動化を否定はしないけど、この使い方は不可能じゃない。wplaceは人気を予想してなかったから、最適化も足りなかったかもな。" userName="LoganDark" createdAt="2025/08/09 14:49:26" color="#ff5733">}}




{{<matomeQuote body="ネットワークモニター開いて2～3分スクロールしただけで500リクエスト、5MB転送されたよ（ベクタータイルデータでフィルタ後）。ブラウザやCloudflareのキャッシュでどれくらい減るかは不明だけどね。たぶん一般的な10～20リクエスト/ユーザーってのは、ほとんどスクロールしないような埋め込みマップの場合だろ。" userName="Karliss" createdAt="2025/08/09 16:03:45" color="#ff33a1">}}




{{<matomeQuote body="ユーザーがマップにテンプレートを重ねるスクリプトを使ってるけど、それが負荷を増やしてるとは思えないんだよな。それよりwplaceが重くて、ピクセルを置いたり変更を見るのにリフレッシュが必要だから、それが毎時間の呼び出しを増やしてるのかもしれないね。" userName="nemomarx" createdAt="2025/08/09 14:56:10" color="">}}




{{<matomeQuote body="この詳細な分析と透明性、ありがとう！StatusGatorの障害マップで、MapTilerからOpenFreeMapへの移行を考えてるんだ。" userName="colinbartlett" createdAt="2025/08/09 14:26:14" color="#ff5c5c">}}




{{<matomeQuote body="自由に移行していいよ。もしHigh Availabilityが心配なら、セルフホスティングも常に選択肢だよ。でも、僕はパブリックインスタンスをできるだけ信頼性高くするために頑張ってるからね。" userName="hyperknot" createdAt="2025/08/09 14:48:20" color="">}}




{{<matomeQuote body="スクショ見て、これ単一VPSでいけるんじゃ？って思ったけど、地球全体の地図にピクセルがあるって気づいてやられたわ！ピーク時のreq/sがどうなってるか気になるなー。ベンチマーク向きのWebサーバーならギリギリいける範囲かも？アプリの性質上、桁違いに遅くなる可能性もあるけど。<br>追記: 1kmあたり64ピクセルらしいね。地球全体をフルカラー非圧縮で覆うと8TBくらいになりそう（長期的には！）。Hetznerなら10TBの箱が月20ユーロだって。キャッシュは絶対必要だろうね ;)<br>追記2: wplaceは描画レイヤーに1000x1000pxのPNGを使ってる。描画はすぐだけど、マップ自体は今すごく遅いし、一部のチャンクは永久に表示されないんだ。" userName="andai" createdAt="2025/08/09 17:29:17" color="#ff5c5c">}}




{{<matomeQuote body="「Hetznerで月20ユーロ」ってのは、本当に必要な時にちゃんと動いてくれてる間は最高だよね。" userName="TylerE" createdAt="2025/08/09 20:36:54" color="">}}




{{<matomeQuote body="＞「Hetznerで月20ユーロ」ってのは、本当に必要な時にちゃんと動いてくれてる間は最高だよね。僕はいくつかのHetzner Cloudインスタンスを管理してるけど、中には1年以上完璧な稼働時間を報告してるものもあるよ。動かないやつは、僕が原因だったな。なんでそんなこと言えるの？なんかデータでもあるの？それともただ適当に言ってるだけ？" userName="motorest" createdAt="2025/08/10 05:44:05" color="">}}




{{<matomeQuote body="＞なんでそんなこと言えるの？<br>https://news.ycombinator.com/item?id=29651993<br>https://news.ycombinator.com/item?id=42365295<br>https://news.ycombinator.com/item?id=44038591<br>＞それともただ適当に言ってるだけ？<br>皮肉はやめなよ。攻撃的な言葉は削除して。<br>https://news.ycombinator.com/newsguidelines.html" userName="slacktivism123" createdAt="2025/08/10 07:00:00" color="#38d3d3">}}




{{<matomeQuote body="今、3つのリンク全部チェックしたけど、君が言うよりもっとニュアンスが複雑みたいだね。" userName="eitland" createdAt="2025/08/10 14:25:30" color="">}}




{{<matomeQuote body="これって全部Hetzner Cloudの提供サービスみたいだね？" userName="Aeolun" createdAt="2025/08/10 10:18:35" color="">}}




{{<matomeQuote body="僕の経験だと、Hetznerは信頼できないってわけじゃないよ。ただ、単一VPSで毎秒10万リクエストは無理だと思うな。（あと、専用サーバーだと、冗長性は自分で管理する責任があるけど、これは他の専用サーバーでも同じだよね。）" userName="immibis" createdAt="2025/08/10 00:49:16" color="">}}




{{<matomeQuote body="サポートの技術力がゼロだから、彼らは信用できない。ドイツ側の部署と取引するとなると、返答に2週間もかかるし、それでも間違った情報が来る。彼らは単純に手間がかかりすぎるんだ。まともなホストを使えよ。" userName="cyberpunk" createdAt="2025/08/10 08:41:37" color="#ff5c5c">}}




{{<matomeQuote body="理想を言えば、みんな優秀なホスティング会社を使いたいけど、無料や低収益のプロジェクトには向かないんだよ。サービスを停止するより、多少のダウンタイムがある方がマシだ。OpenFreeMapとwplace、両方ともHetzner、OVH、Scalewayが良いんじゃないか。コストが抑えられるから、万が一のために別の安いプロバイダーで冗長化もできるぞ。" userName="celsoazevedo" createdAt="2025/08/10 10:55:42" color="#45d325">}}




{{<matomeQuote body="サポートの技術力がゼロだって？俺はサポートに頼る必要ないから完璧じゃん。Hetznerでサポートが必要ってことは、お前がホストを選ぶのを間違ってるだけだろ。" userName="Aeolun" createdAt="2025/08/10 10:16:14" color="">}}




{{<matomeQuote body="“ipfs daemon”を動かしただけで、Hetznerがサービス停止をちらつかせてきたんだ。PCAPダンプ付きで「ハッキング」って警告文が来るし、こっちが正しくても関係ないんだよ。" userName="ranger_danger" createdAt="2025/08/10 21:16:59" color="#45d325">}}




{{<matomeQuote body="そんなことないだろ。俺はipfs daemonを動かしたけど、変な手紙なんて来なかったぞ。Tor relaysへのletterbombing攻撃の時は手紙が来たけど、Hetznerに攻撃のページを見せたら止まったしな。" userName="immibis" createdAt="2025/08/12 02:58:25" color="">}}




{{<matomeQuote body="お前、本番環境に移行して2日後に、トラフィック全部ブラックホールにされたことないのか？運がいいな。" userName="cyberpunk" createdAt="2025/08/10 14:11:31" color="">}}




{{<matomeQuote body="俺はどこかに移行する時、心配だから前のサービスは1ヶ月は動かしたままにする。本番のトラフィックがブラックホールになるってことはないけど、似たようなことだろ。" userName="Aeolun" createdAt="2025/08/10 19:35:27" color="">}}




{{<matomeQuote body="良いアイデアで面白いプロジェクトだな。次は事前に連絡してくれよ。俺の人気サービスでお前の人気ないやつが止まるかもだけど、そっちでAPIの性能がわかるようにしとけ。レートリミットなしのAPIなんてホストしないし、利用制限もちゃんと書いておけよ。" userName="ivanjermakov" createdAt="2025/08/10 08:36:48" color="#38d3d3">}}




{{<matomeQuote body="無料のオープンサービス使うくせに、ずいぶん傲慢な期待だな。リクエストは分散クライアントから来てたんだから、レートリミットに応答できるAPIゲートウェイからじゃない。お前は「APIにレートリミットをかけろ」「利用制限を明確に書け」って言うけど、あれは中央のAPIキーからじゃない。OpenFreeMapはボットやスクリプトが原因で、wlive.placeのユーザー1人につき1500リクエストって計算が出てる。実質DDoS並みの負荷だったんだよ。" userName="Aurornis" createdAt="2025/08/10 14:39:55" color="#ff5733">}}




{{<matomeQuote body="URL originでブロックされてるんだから、レートリミットも同じようにできるはずだろ。サイト利用者からのAPIならそれで問題ないはずだ。ボットはOpenFreeMapのタイルに興味ないから、サイトを介さないボットは来ないって。" userName="zamadatix" createdAt="2025/08/10 18:23:25" color="#ff33a1">}}




{{<matomeQuote body="うーん、それなら同意するよ。だってこれじゃDDoS攻撃と見分けがつかないじゃん。" userName="ivanjermakov" createdAt="2025/08/10 14:49:24" color="">}}




{{< details summary="もっとコメントを表示（1）">}}

{{<matomeQuote body="無料サービスが秒間10万リクエストとかの「ハグ・オブ・デス」にgracefully対応できるって思うのは無理があるよね。実際耐えたのはマジ例外だし。一時的にでも秒間10リクエスト以上無料サービスに当てるのは、正直「つけこんでる」って言われても仕方ないと思うな。" userName="Aeolun" createdAt="2025/08/10 10:13:43" color="#ff5c5c">}}




{{<matomeQuote body="＞事前に連絡してって言われても、プロジェクトがバズるなんて予測できないじゃん。<br>＞お前がサービスを壊したって言うけど、それって高すぎる fd limit のせいじゃない？無制限って宣伝しといて、使いすぎたユーザーを責めるのはマジないわ。ユーザーが悪意を持ってAPIを叩いたわけじゃないんだし。" userName="charcircuit" createdAt="2025/08/09 14:52:18" color="#38d3d3">}}




{{<matomeQuote body="お前、マジで図々しいな…。お前みたいな奴がいるから、せっかくの素晴らしいものに「無制限だけど…」みたいな但し書きがついちゃうんだよ。人のインフラをストレステストするなんてありえない。マジで良くない。この記事の作者はすごく理解があって、ブロックした後でも解決策を提示しようとしてくれたんだぜ。無料サービスなのに。お前がやったこと、見せてみろよ。" userName="columb" createdAt="2025/08/09 15:10:07" color="">}}




{{<matomeQuote body="＞図々しいって言うけど、それが契約ってもんだろ。ハンバーガーを5ドルで売ると言ったら、5ドル払った客はハンバーガーをもらう権利があるだろ？<br>＞無料サービスなのにって言うけど、サービスの値段を決めるのは所有者だろ。制限なしでトラフィックが多すぎてパンクするのは、無料サービスに限った問題じゃないんだよ。" userName="charcircuit" createdAt="2025/08/09 15:21:15" color="#785bff">}}




{{<matomeQuote body="＞SLA保証や個別サポートを提供してますか？<br>＞今のところ、SLA保証や個別のサポートは提供していません。<br>これ、ウェブサイトに書いてあったことだよ。" userName="perching_aix" createdAt="2025/08/09 16:18:55" color="#ff5c5c">}}




{{<matomeQuote body="確かに、ハンバーガーの例は完璧だね。5000個もまとめて注文するなら、店は値段通り売ってくれるだろうけど、「それだけの量を捌くには事前連絡が必要だよ」って言うだろ。マジで完璧なアナロジーだよ。この作者は状況に完璧に対応したと思う。" userName="eszed" createdAt="2025/08/09 16:54:39" color="">}}




{{<matomeQuote body="でもこの場合、レストランは、もし自分たちで勝手に店員の手を縛って邪魔してなかったら、5000個の注文を処理できたはずなんだよ。そして、店員の手を解いて、偶発的にボトルネックになってたことに気づいたのを評価する代わりに、彼らは客足の増加を引き起こした近くのイベントを非難したんだ。<br>ユーザーを公に攻撃するんじゃなくて、彼らの成功と自分の新しい学びを祝うべきだよ。俺は、人々が目標達成にどうプラットフォームを使ってるかを祝う「ハロー効果」戦略の方が、その価値を理解して採用したり財政的に支援したいと思わせるのに役立つと思うな。一方で、プラットフォームを使ってる人を公に攻撃したら、自分も批判されるんじゃないかって使いたくなくなるだろ。" userName="charcircuit" createdAt="2025/08/09 18:02:08" color="#ff33a1">}}




{{<matomeQuote body="ハンバーガーの状況は比較にならないね。あれは商売だろ。これはただ、誰かが自分のPCにあるテキストファイルに、あんまり詳しくないことを書いただけなんだから。俺もそういうメモたくさん持ってるし、中には公開してるやつもあるよ。" userName="austhrow743" createdAt="2025/08/10 01:10:11" color="">}}




{{<matomeQuote body="彼にサービスを壊れたままにさせるか、それともこのボランティアプロジェクトのために自己負担で無限にスケールアップするのを期待するのか？彼は、文字通り何の義務もないのに、プロジェクトの作者と協力して、両方にとって機能して、他の全ユーザーのサービスを悪化させない解決策を見つけたんだ。<br>これは、月に何百ドルも払ってるユーザーをスロットリングするAnthropicの決定とは違う。建設的な批判はいいけど、個人ボランティアが無料で運営してるものに権利を主張するのはありえないだろ。" userName="10101010101" createdAt="2025/08/09 15:17:37" color="#785bff">}}




{{<matomeQuote body="このプロジェクトページは無限のコストになる可能性を示唆してるみたい。財政的には、帯域をカバーするまでサーバーを借り続ける計画だって。サポートプランに十分な人が加入すれば自己持続可能になるって信じてるよ。CloudflareがCDNを無料で提供してるから特にね。オリジンサーバーの運用は金がかかるけど、fd制限は通常低いから、もっと高く設定できる。いつかI/O制限にぶつかるだろうけど、俺のざっくり計算だとオリジンでのI/Oはかなり管理しやすいように見えるな。もしファイルが全部小さくて、fd制限が本当のボトルネックなら、それもうまくやる方法はあるよ。俺の意見だと、ファイルを読み込むためのfdが確保できないなら、そもそもインバウンド接続を受け入れる意味がない。だから、同時接続を制限して、接続をlistenキューで待たせ、短いkeepaliveタイムアウトでアイドル接続にfdを無駄にしないようにするのがいい。他の知識がないなら、オリジンサーバーがこれ専用で静的ファイルだけを扱うとして、接続制限はFD制限の半分にするね。でも、正直に言って、こんなの立ち上げたらFD制限については、ぶつかるまで考えなかっただろうな。大したことないよ…願わくば、監視ツールがデフォルトで利用可能なfdを含んでいて、気づいてくれるといいんだけど、どこでもデフォルト出力ってわけじゃないからな。" userName="toast0" createdAt="2025/08/09 17:07:19" color="#ff5c5c">}}




{{<matomeQuote body="俺たちが話してるのは、固定された静的ファイルをホスティングすることだぜ。これは解決済みの問題だろ。大規模なAIモデルを人々のために動かすのとは全然違うんだよ。" userName="charcircuit" createdAt="2025/08/09 15:24:50" color="">}}




{{<matomeQuote body="無制限のサービスを無料で運営するのは、1リクエストをさばく限界コストにかかってるよ。" userName="charcircuit" createdAt="2025/08/09 15:35:06" color="">}}




{{<matomeQuote body="面白いことに、彼のサービスは壊れてないんだぜ。Cloudflareのキャッシュが99%のリクエストを処理したからね。ただ、力を示したかっただけで、最新のバズトレンドを壊したかっただけだろ。" userName="rikafurude21" createdAt="2025/08/09 15:20:57" color="">}}




{{<matomeQuote body="遭遇した制限がオープンファイルの数だったなら、その制限を上げればいいんじゃない？スパムトラフィックをブロックするのはわかるけど、理論的にはその制限を上げたらもっと捌けたんじゃないの？" userName="ch33zer" createdAt="2025/08/09 16:12:37" color="">}}




{{<matomeQuote body="複数のLLMと長いデバッグセッションの後、Nginxコミュニティフォーラムに質問を書いてみたんだ。今のところ、`multi_accept + open_file_cache ＞ worker_rlimit_nofile`の組み合わせが原因だったと思ってる。<br>https://community.nginx.org/t/too-many-open-files-at-1000-re...<br>それに、サーバーは200 Mbps出てたから、制限がどうあれ、これ以上は長くは持たなかっただろうね。" userName="hyperknot" createdAt="2025/08/09 16:43:49" color="#785bff">}}




{{<matomeQuote body="お前の`open file cache`はデカすぎると思うよ。1k/秒で60分キャッシュするなら、全部ユニークだと仮定して300万FDのキャッシュを要求してることになる。利用可能は100万しかないのに。俺はNginxも`open_file_cache`も使ったことないけど、設定を大幅に下げて、通常の運用でパフォーマンスに違いが出るか試してみたら？例えば、1万ファイル、60秒タイムアウトとかね。200 Mbpsでシステム過負荷かコストか？ストレージの種類は？ディスクI/Oは監視してる？CPUは何使ってる？俺はデュアルE5-2690でHTTPSで10GBps近く出したことがあるけど、ファイルはもっとデカかった。2690sはハイエンドだったけど、もっと新しいのはAESアクセラレーションがずっと良くて、何にせよ200 Mbpsよりははるかに良いはずだぜ。正直言うと、`open_file_cache`の意図がよく分からないんだ…ファイルを開くのは通常そんなにコストがかからないしね。何十万rpsとか、非常に複雑なファイルシステムとかでない限りは。PS: 何万ものファイルを1つのディレクトリに入れるなよ。100個のディレクトリにそれぞれ100個のファイルを入れるみたいに、ファイルを分割すると何でもうまくいく。負荷に合わせて実験してみるといいけど、N層のMディレクトリがあって、最後の層にM個のファイルがあるツリー構造が良い計画だ。64 ＜= M ＜= 256で。ディレクトリをコンパクトに保って、検索や編集が効率的になるのが目標だぜ。<br>https://www.intel.com/content/www/us/en/products/sku/64596/i..." userName="toast0" createdAt="2025/08/09 17:31:47" color="#45d325">}}




{{<matomeQuote body="俺、ちょっとヒントがあるかも—Nginxがダイヤルアップ時代に作られたこと、覚えてる？Pentium 3のサーバーが標準だった頃だ（俺もその頃のRambler DCでwwwXXXマシンを見た覚えがあるよ）。だから、俺のちょっとした educated guessだけど、あらゆるシステムコールを節約するのが究極の目標だったんじゃないかな。当時は少なくともレイテンシの面で効率的だったんだよ。NginxがHTTPメソッド（GET/POST）をどう解析してオペレーションを節約してるか、見てみてもいいかもね。俺自身は`open_file_cache`を使って大きなメリットを感じたことはないけど、ちゃんとしたパフォーマンステストをしたことはないんだ。例えば、`sendfile`や`buffers`、TLS terminationの使用を確実にする方が、現代の（10～15年前の）ハードウェアではずっと大きな影響があったね。" userName="CoolCold" createdAt="2025/08/11 07:49:43" color="#ff5c5c">}}




{{<matomeQuote body="Cloudflareのキャッシュ後で200Mbpsだと、Hetznerのトラフィックにすぐ達しちゃうよ。月20TBが上限だから、およそ9日で到達する計算だね。" userName="Aeolun" createdAt="2025/08/10 10:21:13" color="#45d325">}}




{{<matomeQuote body="VMの話をしてるんだろ？VMにはトラフィック制限があるよ。でも、物理サーバーは普通1Gbit NICがついてるから制限はないはずだ（何ヶ月も帯域の80%以上使うまでは、だけどね）。引用するとね、<br>＞トラフィック<br>＞すべてのルートサーバーはデフォルトで専用の1Gbitアップリンクを持ってて、トラフィックは無制限。10Gアップリンクのサーバーだと月間20TBが含まれてる。帯域制限はないけど、20TB超えたら1TBあたり1ユーロ（1.20ドル）かかるよ。" userName="CoolCold" createdAt="2025/08/11 07:39:13" color="#ff5c5c">}}




{{<matomeQuote body="へぇ、俺が契約終えた数年前とは変わったんだな。archive.orgで見たら、少なくとも5年前から無制限だったみたいだ。誰かが20TBって言ってたのを聞いて、妥当な制限だと思っちゃったんだろうな。" userName="Aeolun" createdAt="2025/08/12 16:33:50" color="">}}




{{<matomeQuote body="OpenFreeMapみたいなサービスって、外部のオンラインサービスに頼るんじゃなくて、自前のサーバーラックを持つべきじゃないのか？最近はそういうのってあり得ないのかな？" userName="johnisgood" createdAt="2025/08/10 15:45:03" color="">}}




{{<matomeQuote body="ちょっと補足だけど、その制限はHetzner Cloudサーバーの話ね。専用サーバーはトラフィック無制限だよ。" userName="MaKey" createdAt="2025/08/10 16:03:56" color="#45d325">}}




{{<matomeQuote body="接続によるんじゃないかな。俺のは1Gbit＼secだけど20TB制限がある。100Mbitのは無制限だったな（最後に確認した時だけど）。" userName="Aeolun" createdAt="2025/08/10 19:37:04" color="">}}




{{<matomeQuote body="そうそう。1Gbit＼sの専用サーバーはトラフィック無制限で、10Gbit＼sは20TBのトラフィックが含まれてるんだ。100Mbit＼sのオファーは知らないな。どのオファーを使ってるか分からないけど、Hetzner Cloudサーバーじゃなくて専用サーバーの話に聞こえるね。" userName="MaKey" createdAt="2025/08/12 00:30:10" color="#ff5c5c">}}




{{<matomeQuote body="空のタイルファイルを実際に作って、必要な場所全部にハードリンクするっていうのがいいかもね。そうすれば実行時に特別な処理は要らなくて、生成時に済む。NVMeディスクはめちゃくちゃ速いし、1k rpsなんて大したことないよ（俺のn100でも1Gbit NICがボトルネックにならなきゃ40kくらいはいけたはず）。チューニングオプションなしでベンチマーク試してみたら？Cloudflareから実際に40k同時接続来てるのか？" userName="ndriscoll" createdAt="2025/08/09 16:58:19" color="#38d3d3">}}




{{<matomeQuote body="ああ、それは良いアイデアだね。でも、タイルの90%以上が空（もしかしたら間違ってるかも）って話だから、ものすごい数のハードリンクになるよ。nginxの設定を直す必要があると思う。フォーラムで助けが得られるといいんだけど。" userName="hyperknot" createdAt="2025/08/09 17:04:21" color="">}}




{{<matomeQuote body="ファイルディスクリプタキャッシュをオフにするのも試してみたら？NVMe SSDは並列処理なしでも毎秒30〜50kのランダムリードができるし、並列処理があれば数十万だって可能だよ。だから、リクエストごとにディスクを10回叩いたとしても大丈夫なはず。カーネルキャッシュもあるしね、nginxのメタデータキャッシュの一部はそれで賄われるんじゃないかな？" userName="ndriscoll" createdAt="2025/08/09 17:38:00" color="#ff5733">}}




{{<matomeQuote body="”いくら制限があっても、これ以上長くは持ちこたえられなかった”って引用だけど、なぜそのレートだと時間が経つと問題になるの？" userName="justinclift" createdAt="2025/08/10 04:46:21" color="">}}




{{<matomeQuote body="へー、OpenStreetMapを見るシンプルな方法がやっとできたんだね！　ずっと待ってたから嬉しいよ！" userName="Ericson2314" createdAt="2025/08/10 02:16:27" color="">}}




{{<matomeQuote body="本家のサイトに何か問題あったの？　純粋な疑問なんだけど https://www.openstreetmap.org" userName="bspammer" createdAt="2025/08/10 10:15:06" color="#ff5c5c">}}

{{</details>}}




{{< details summary="もっとコメントを表示（2）">}}

{{<matomeQuote body="えーと…俺が最後に見た時はそれ無かったけど？" userName="Ericson2314" createdAt="2025/08/11 20:01:14" color="">}}




{{<matomeQuote body="OSM Foundationは何年も前からラスタタイルを提供してるよ（www.openstreetmap.orgのマップでデフォルトで見えるやつね）： https://wiki.openstreetmap.org/wiki/OpenStreetMap_Carto<br>いろいろなコントリビューターが試行錯誤した結果、OSMFはついにベクタータイルもリリースしたんだ： https://operations.osmfoundation.org/policies/vector/" userName="drewda" createdAt="2025/08/10 15:29:49" color="#ff5c5c">}}




{{<matomeQuote body="ありがとう、俺が情弱だったわ" userName="Ericson2314" createdAt="2025/08/11 20:01:39" color="">}}




{{<matomeQuote body="…そしてその後、毎秒100万リクエストになったと！" userName="bravesoul2" createdAt="2025/08/10 04:41:25" color="">}}




{{<matomeQuote body="それって、毎秒1,000リクエストを彼らが耐えて、残りの毎秒99,000リクエストはCloudflare CDNが耐えたって感じだね" userName="fnord77" createdAt="2025/08/09 14:47:42" color="#785bff">}}




{{<matomeQuote body="リファラーでの制限は変じゃない？　普通のユーザーが毎分10～20リクエストするとして、IPアドレスごとに毎分100リクエスト（平均の5倍）に制限すれば、大半のケースをブロックできるんじゃない？　少数の悪質な利用者ならJA4/JA3フィンガープリントでブロックするとか？" userName="eggbrain" createdAt="2025/08/09 14:55:22" color="#ff33a1">}}




{{<matomeQuote body="もし一人のユーザーが世界中を巡ってマップを探検したい場合はどうなるの？　Google Earthのデスクトップ版で30分も面白い場所を探索したの覚えてるよ。リファラーベースの制限の方が良いと思うな。そうすれば、たくさん使うユーザーにパブリックインスタンスじゃなくてセルフホスティングを選んでって頼めるし" userName="hyperknot" createdAt="2025/08/09 15:02:23" color="#ff5733">}}




{{<matomeQuote body="リファラーによる制限は最初の適切なステップだろうね。（フロントページのテキスト変更も）ユーザーじゃなくてサイトごとの利用状況を追跡したいんだろ？　だって、サイトには利用パターンを変えてって頼めるけど、ユーザーには無理だからね。IPアドレスごとの制限もアリだけど、これに効果的なほど低くはしたくないだろうし" userName="toast0" createdAt="2025/08/09 17:36:02" color="#785bff">}}




{{<matomeQuote body="wplace.liveみたいなサイトがキャッシュしないのって、いつも「怠慢」なのかな？なんで自分たちでキャッシュサーバー使って、OpenFreeMapのトラフィックを減らさないんだろう？OpenFreeMapより速くタイルを提供できるのにさ。" userName="rtaylorgarlock" createdAt="2025/08/09 15:36:00" color="">}}




{{<matomeQuote body="OpenFreeMapがCDN使ってて、「完全に無料、リクエスト数無制限。商用利用OK」って言ってるのに、なんで彼らがキャッシュする必要あるの？彼らが「ぜんぜんOK、無制限、無料」って言ってるんだから、そのまま使うのが理にかなってるでしょ。トラフィック量が気にならないわけじゃないけど、もしサイトが急にバズったら、他のことで忙しくなるだろうしね。" userName="toast0" createdAt="2025/08/09 16:49:30" color="#ff33a1">}}




{{<matomeQuote body="礼儀と速度の問題？でもプロジェクトのアーキテクチャ次第だよ。タイルがクライアント側でしか使われないなら、自分のサーバーでキャッシュする理由なんてほとんどないね。それは自分がOpenStreetMapよりキャッシュが上手いってことになっちゃう。それにシステムを needlessly に複雑にするだけだ。OpenStreetMapも怒る理由なんてないよ。だって俺が200万リクエストしてるわけじゃなくて、200万人の別々のユーザーが使ってるんだから。これはOSMとその派生作品をもっと多くの人に使ってもらうという彼らの動機と一致してるし、問題ないよ。" userName="radu_floricica" createdAt="2025/08/10 14:51:19" color="#ff5c5c">}}




{{<matomeQuote body="それを読んだら、「突然金を払えって言われることはないな」って安心するべきだよ。それで「みんなのために無料提供を守るために、こっちでキャッシュを実装しよう」って思うのが普通じゃない？本気で、「よし、これを悪用できるぞ」って最初に考えるやついる？" userName="Aeolun" createdAt="2025/08/10 10:25:11" color="">}}




{{<matomeQuote body="「悪用できない」って考え続ける必要はないよ。ただ考えるのをやめればいいだけさ。" userName="naniwaduni" createdAt="2025/08/10 12:51:46" color="">}}




{{<matomeQuote body="これには直接の答えがあるよ。それは「優先順位」だね。<br>俺は結構人気のあるオークションサイトを運営してるんだけど、Stadia Maps経由で地図タイルを使ってる。このサービスには月80ドルくらい払ってるんだ。タイルをキャッシュしてプロキシから提供すれば、もっとコストを下げられるのは確かだけど、まだこれに取り組む時間が取れてないんだ。いつももっと優先度の高いタスクがあるからね。" userName="VladVladikoff" createdAt="2025/08/09 15:46:52" color="#38d3d3">}}




{{<matomeQuote body="ここではとんでもない量のデータが問題になってるんだ。56Gbit/sだよ（1Gbitサーバー56台が100%フル稼働してる計算だね！）。<br>これは普通の「キャッシュサーバー」が扱えるレベルじゃない。CloudflareみたいなCDNネットワークの規模じゃないと無理な話さ。" userName="hyperknot" createdAt="2025/08/09 15:55:01" color="">}}




{{<matomeQuote body="＞ここではとんでもない量のデータが問題になってるんだ。56Gbit/sだよ。これは普通の「キャッシュサーバー」が扱えるレベルじゃない。<br>56Gbit/sなら、とんでもないデータ量ってわけじゃないよ。もちろんキャッシュサーバーで処理できるさ。情報源：古いクアッドコアで40Gbit/s（TLS付き）を飽和させたサーバーを書いた経験がある。" userName="Sesse__" createdAt="2025/08/09 19:28:13" color="#ff33a1">}}




{{<matomeQuote body="OK、技術的にはそういうサーバーも存在するのかもしれないね、Netflixとかが使ってるやつかな。でも、ここで話してるのはコミュニティに支えられた無料サービスだよ。Hetznerサーバーしか選択肢がないんだ、無制限の帯域幅だからね。" userName="hyperknot" createdAt="2025/08/09 20:12:27" color="">}}




{{<matomeQuote body="アクティブなデータがRAMに収まるなら、市販のハードウェアとソフトウェアで全く問題ないよ。40ギガのNICを2枚ぶっ刺してVarnishとか入れればOKさ（もちろん、ユーザーへの帯域幅にお金を払う人がいる前提だけどね！）。<br>データの大部分をディスクから提供する必要があるなら話は別だけど、Netflixは3年前から800ギガを（大部分がディスクから）やってたし、OSの選択で自分たちでスケーリング作業をかなりやる必要があって不利な状況だったのにね。" userName="Sesse__" createdAt="2025/08/09 21:12:03" color="#ff5733">}}




{{<matomeQuote body="サーバーのハードウェアは問題ないと思うよ。全データが150GBでサーバーには64GBのRAMがあるけど、ほとんどはリクエストされないだろうから、使われるタイルはOSキャッシュから提供されるはず。もしダメでもRAID 0のNVME SSDにローカルで接続されてるしね。<br>俺が言ってたのは、無制限の1Gbps接続でさえ結構高いのに、2x40ギガの接続なんてリーズナブルな値段で見つけるのが難しいってことだよ。あのユーザーは24時間で200TBも生成したんだって！帯域幅の料金は全然知らないけど、それを賄うのは絶対安くないはずだ。" userName="hyperknot" createdAt="2025/08/09 21:24:14" color="#ff33a1">}}




{{<matomeQuote body="うーん、「帯域幅は高い」ってのはその通りなんだけど、「普通のキャッシュサーバーが56Gbit/秒を処理できない」ってのは、全く別の話じゃない？" userName="Sesse__" createdAt="2025/08/09 22:03:22" color="#ff33a1">}}




{{<matomeQuote body="君の言う通りだよ。俺は「そっち側のキャッシュサーバー」ってのを、VPSで動いてる個人のホビープロジェクトが週末に急にトラフィック爆増したって文脈で考えてたんだ。そういうサーバーが存在するし、いくつかの会社は通常のオペレーションの一部としてその帯域幅にちゃんとお金を払ってるってのは同意するよ。" userName="hyperknot" createdAt="2025/08/09 22:20:36" color="#38d3d3">}}




{{<matomeQuote body="Hetznerでさえ、56Gbit/秒は1日あたり約590ユーロかかるんだぜ。" userName="Aeolun" createdAt="2025/08/10 10:32:01" color="#45d325">}}




{{<matomeQuote body="「ぶっ飛んでる」ってのが主観的な判断だってのは分かってるんだけど、でも、うーん…56Gbpsは間違いなくぶっ飛んでるって言うね。それを扱えるハードウェアが存在しないって言ってるわけじゃないし、特にぶっ飛んだハードウェアじゃなくてもいいかもしれないけど、俺の基準ではかなりぶっ飛んだデータレートだよ。" userName="bigstrat2003" createdAt="2025/08/10 05:52:52" color="">}}




{{<matomeQuote body="＞または56台の1Gbitサーバーが100%飽和<br>おそらくキャッシュサーバーは10GbE、40GbE、または100GbEだろうね。<br>56Gbit/秒の事前生成データは、各リクエストが大量のランダムディスク読み込みを生成しない限り、1台か2台の良いサーバーで確実に処理できるよ。" userName="wyager" createdAt="2025/08/09 16:08:53" color="#ff33a1">}}




{{<matomeQuote body="NginxがN150で静的ファイルを配信して10Gbitリンクを使い切れないのはちょっと驚きだね。だから、200ドルのミニPCが6台あれば処理できると思うよ。一番お金がかかるのはホスティング／接続だろうけどね。" userName="ndriscoll" createdAt="2025/08/09 16:25:19" color="#45d325">}}




{{<matomeQuote body="楽しそうなウェブサイトだね、営利目的じゃないみたいだし。楽しいウェブサイトの期待や焦点は、規模を捌くことより、とにかく動かすことにあるもんね。ユーザーベースが夜中に爆発的に増えて、約14時間ごとに倍増してるみたいだし。それに、メンテナの言葉遣いからすると、一人でやってるか少人数のグループって感じだね。" userName="markerz" createdAt="2025/08/09 15:48:07" color="">}}




{{<matomeQuote body="CDNとかクラウドストレージプロバイダーが、PMTilesファイルを共有ライブラリとして顧客に提供しないのは本当に驚きだよ。きっと彼らは、顧客それぞれに120GBのファイルをアップロードさせて、個別に料金を請求する方が好きなんだろうね。<br>もし賢ければ、ストレージの設定で基盤インフラには実際のコピーが1つしかなくて、他のシャドウコピーは全部純粋な利益になるようにしてるはずだけどね。" userName="cube00" createdAt="2025/08/10 14:26:48" color="#45d325">}}

{{</details>}}



[記事一覧へ]({{% ref "/posts/" %}})
