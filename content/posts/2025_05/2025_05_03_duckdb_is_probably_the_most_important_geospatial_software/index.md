+++
date = '2025-05-03T00:00:00'
months = '2025/05'
draft = false
title = 'この10年で最も重要な地理空間ソフトはおそらくDuckDBだ！'
tags = ["DuckDB", "地理空間", "データベース", "分析", "パフォーマンス"]
featureimage = 'thumbnails/red2.jpg'
+++

> この10年で最も重要な地理空間ソフトはおそらくDuckDBだ！

引用元：[https://news.ycombinator.com/item?id=43881468](https://news.ycombinator.com/item?id=43881468)




{{<matomeQuote body="DuckDB超好きで地理空間分析もやってるよ。H3とか距離とか面積とか、点が含まれる図形検索とかね。これはgeopandasやPostGISにもあるから、DuckDBの空間拡張が特別新しいわけじゃないんだ。でもね、DuckDBエンジンがいいのは、ローカルPCでParquet/GeoParquetファイルをデカい規模で直接扱えること！ベクトル化とか並列化も効くし。これはgeopandasより全然いいわ。生活の質が上がったレベル（笑）。Hilbert curvesとかUber H3みたいな変わり種を足せる拡張構造もあるよ。リンク見といてね。<br>https://duckdb.org/docs/stable/extensions/spatial/functions....<br>https://duckdb.org/community_extensions/extensions/h3.html" userName="wenc" createdAt="2025/05/03 21:37:01" color="#ff5733">}}




{{<matomeQuote body="マジでこれ同意だわ。DuckDBは適当なデータセット扱うだけでも超QoL向上だった。PandasとかPostgres、Databricksよりデータ探索がめちゃ楽。地理空間機能は俺がガッツリやってた時はまだ出たばっかだったけど、それでも良かった。Pandasはメモリ問題とか規模がデカくなると問題あったけど、PolarsやDuckDBでは全然ない。geopandasも同じね。GDALとか単体は正直微妙だし、QGISからJupyter notebooksに落とすのも面倒い。地理空間分析って普通のデータ分析より10年遅れてる気するわ。Shapefilesとかクソだし。PostGISとかgeopandasはいいけど、もっと色々あるじゃん。PowerBIも最近まで微妙だったし。結論、DuckDB空間機能はマジ cool & helpful！" userName="sroerick" createdAt="2025/05/04 16:01:36" color="#ff33a1">}}




{{<matomeQuote body="＞余談だけど、新人がまずPowerBIにデータ突っ込んで探索してたんだけど、これが驚くほど使えるワークフローだったんだよね。<br>DuckDBと比べてPowerBIの何が驚くほど便利だったの？" userName="ngrilly" createdAt="2025/05/04 20:15:28" color="">}}




{{<matomeQuote body="グラフィックスだよ。優秀なBIツールは、すごく効果的なデータ探索ツールになるんだ。" userName="datadrivenangel" createdAt="2025/05/05 00:53:42" color="">}}




{{<matomeQuote body="測地線や再投影じゃなくて、なんでhaver-sineを使うの？<br>俺はgeopandasが推奨しててそれに合わせてるから、前は「ローカルな」CRSに座標を再投影する方法でやってたんだ。でも、地球上のあらゆるオブジェクト間の距離を計算したい段階になって、何を選ぶのがいいかマジで興味あるんだよね。教えてほしいな。" userName="wodenokoto" createdAt="2025/05/04 06:29:18" color="#38d3d3">}}




{{<matomeQuote body="ただのアプリ開発者で、地理空間の専門家じゃないけど、再投影って何か特定のニーズがない限り、ライブラリが裏側で処理すべきことに思えるな。PostGISのST_Distance(geography point1, geography point2)みたいな人間工学というか、初心者でも間違えにくいのが使い慣れてて、メートルで正確な答えをくれるんだ。もっと速く距離計算したいなら、簡単に球面距離や直交座標距離に切り替えられるしね。ST_Area(geography geog)とか使えば、地球上のどこでも図形の面積を平方メートルで出してくれる。" userName="code_biologist" createdAt="2025/05/04 08:33:45" color="">}}




{{<matomeQuote body="「正しい答え」が何かは、アプリケーションや分析者によって全然違うよ。それが座標参照系（CRS）がたくさんある理由の一つなんだ。もし全部3857でやれば、メートルで答えは出るけど、それが「正しい」かどうかは、距離やジオメトリの場所や大きさ、必要な精度によって変わる。だから、実際は誰かのニーズは必ず「特定」なんだよ。" userName="dmillar" createdAt="2025/05/04 21:46:36" color="#38d3d3">}}




{{<matomeQuote body="Vincenty [1] か Karney (もっと頑丈な解決策なら) [2] を調べてみて。ほとんどの用途ではVincentyで十分なはずだよ。<br>[1] https://en.wikipedia.org/wiki/Vincenty’s_formulae<br>[2] https://github.com/pbrod/karney" userName="colkassad" createdAt="2025/05/04 11:14:12" color="#38d3d3">}}




{{<matomeQuote body="再投影は局所的には正確だけど、広範囲になると不正確なんだ。測地線が一番正確（Vincentyとか）だけど、計算負荷が高い。Haversineはそのいい中間だね。" userName="wenc" createdAt="2025/05/04 17:34:16" color="#45d325">}}




{{<matomeQuote body="でも、本当に広範囲だと不正確なの？<br>投影図を描く時に広範囲で不正確になるのは分かるんだけど、もし赤道上の0,0からの南北方向と東西方向をメートルで全部計算したら、距離計算って全部正確になるんじゃないの？<br>例えば、東に5,000,000メートル、北に0メートルなら、原点から5,000kmだよね。どうやったら遠ざかるにつれて不正確になるのか分からないんだ。不正確さはどこで入ってくるの？地球上の座標に再投影し直す時かな？" userName="wodenokoto" createdAt="2025/05/05 04:04:47" color="#ff33a1">}}




{{<matomeQuote body="Hilbert曲線について言えばさ、特定の精度で空間の長方形に対応する曲線上のセグメントを返す関数、なんでないのかなって疑問に思ったんだよね。この機能って他のとこにまとめて入ってるの？" userName="everybodyknows" createdAt="2025/05/04 20:33:47" color="">}}




{{<matomeQuote body="記事の「冷たい状態から始めるのが大変だった」って話さ、PostGISなんか10年以上前から「CREATE EXTENSION postgis;」でいけたんだよ。PGとかMySQL、Oracle、MS SQL Server、SQLiteにも昔から空間拡張あったしね。DuckDBがインストールを特別簡単に変えたわけじゃないと思うんだ。" userName="Demiurge" createdAt="2025/05/03 23:37:15" color="#45d325">}}




{{<matomeQuote body="Postgresだとデータが既に入ってないとダメで、そうじゃないならまずETLしなきゃいけないんだよね。一方DuckDBはデータそのまま（Parquet、TSV、sqlite、postgres...ディスクでもS3でも）使えるからETLの手順がいらないんだよ。自分はParquetデータをETLなしで直接扱ってる。JupyterとかPythonのREPLでduckdb.query(”from ’*.parquet’”)ってすぐできる。もし間違ってたら教えて欲しいんだけど、Postgisじゃそれは無理だと思うんだよね（even pg_parquet requires copying? [1]）[1] https://www.crunchydata.com/blog/pg_parquet-an-extension-to-..." userName="wenc" createdAt="2025/05/04 00:18:55" color="#ff5733">}}




{{<matomeQuote body="そうだね、GeoParquetで作業したいなら、そしてデータをその形式のまま持ちたいなら、それは例として分かりやすいかも。でも、多くの地理空間データはそうじゃないんだよ。ShapefileとかGeoPackage、GeoJSON、何があるかわからない。QGISからESRIまで、色々な形式で様々な問題を解決するためのソフトがいっぱいある。GeoParquetは今一番速い地理空間ベクトルデータ形式かもしれないけど、そんなに一般的じゃないと思うし、記事もそう主張してない。だから、何かGISの質問に答えようとする平均的なユーザーを考えると、ETLは平均的に見てほぼ避けられないことなんだ。で、それを前提とすると、PostGISのインストールもDuckDBのインストールも、どちらもETLが必要だし、クエリや分析言語を学ぶ必要もある。DuckDBは改善かもしれないけど、記事が言ってるほどの大躍進ではないのは確かだよ。" userName="Demiurge" createdAt="2025/05/04 00:36:00" color="#ff33a1">}}




{{<matomeQuote body="DuckDBの地理空間ドキュメントからのこれさ、すごーーく助かると思うんだよね。<br>SELECT * FROM ’./path/to/some/shapefile/dataset.shp’;<br>COPY table TO ’some/file/path/filename.geojson’<br>WITH (FORMAT gdal, DRIVER ’GeoJSON’, LAYER_CREATION_OPTIONS ’WRITE_BBOX=YES’);" userName="sroerick" createdAt="2025/05/04 16:07:13" color="#785bff">}}




{{<matomeQuote body="ogr2ogrもめちゃ便利だよ。<br>ogr2ogr -f ”PostgreSQL” -t_srs ”EPSG:2274” PG:”host=host user=user dbname=database password=trustno1 schemas=schema” shapefile.shp -nln new_name_for_table<br>DuckDBも試してPostgisと比較してみるよ。最終的には、同じデータベースに接続するアプリでベクター出力全部使うってところが問題になるかもね。" userName="Demiurge" createdAt="2025/05/04 16:25:50" color="#ff5c5c">}}




{{<matomeQuote body="そうそう、DuckDBのQoLの問題の一例なんだけどさ、他の場合はファイルをまとめて扱えるのに、GDALにパラメーター渡すやり方のせいでまとめてくれず、文字通りに解釈されちゃうんだよ。だから3000万個のGeoJSONファイルが入ったディレクトリをクエリできない。これ、geopandasだと問題ないんだよね。完全な対話型開発環境だから好きなやり方でまとめてファイル指定できるから。これってSQLパターンの根本的な問題だと思うんだ。うまくいくように試みるけど、ダメだった時どうするの？って話。" userName="jeffbee" createdAt="2025/05/04 01:25:46" color="#38d3d3">}}




{{<matomeQuote body="これ、たぶんまだSpatialに実装されてないだけだと思うよ。DuckDBは今、データレイク形式に注力してて、複数のファイルをまとめて処理する方法を大規模にリファクタリングしてる最中なんだけど、次のリリース後にそのコードがちょっと落ち着いたら、Spatialでも対応する計画なんだ。" userName="maxxen" createdAt="2025/05/04 01:35:47" color="#785bff">}}




{{<matomeQuote body="「SQLパターンの根本的な問題」についてさ、SQLはDSLだし、そう、DSLは解析エンジンのサポートしてることしかできないのは当然だよ。でも、僕が知ってる限り全てのSQLデータベースはカスタム拡張を書くことを許可してるんだ。それこそがまさにそれで、データベースの基本機能に新しいパラダイムを追加するものなんだよ。例えば、Postgresで地理空間機能を有効にするPostgisとか、あいまい一致検索を可能にする拡張とかね。それにSQLはほぼチューリング完全だから、構文が好きじゃないってことはあっても、それでほとんどできないことはないんだよ。" userName="ffsm8" createdAt="2025/05/04 05:47:21" color="#ff33a1">}}




{{<matomeQuote body="DuckDBってipythonで使うとglobbing問題解決できるんだぜ。そしたらgeopandasでOOMに悩まされなくて済むよ。" userName="broner" createdAt="2025/05/04 21:26:52" color="#785bff">}}




{{<matomeQuote body="間違ってないね。まずPGに読み込んで、それからクエリするんだ。DuckDBのUVPってのは、よくある8つのツールとか機能を一つにまとめたみたいなもんかな。" userName="edoceo" createdAt="2025/05/04 00:27:59" color="">}}




{{<matomeQuote body="簡単なインストールってメリットはちょっと大げさかな。本当のポイントはクラウドネイティブな統合と圧倒的なスケーラビリティだと思うな。" userName="keynesyoudigit" createdAt="2025/05/09 23:40:41" color="">}}




{{<matomeQuote body="元の記事って、なんかDuckDBのマーケティング記事みたいに感じるわ。息をのむような賞賛とか、タイトルみたいに根拠のない主張とか。" userName="paradox460" createdAt="2025/05/04 17:35:35" color="">}}




{{<matomeQuote body="spatialite試したことあるけど、まあまあ動くは動くんだよね。でもデータ入れるときのセットアップがちょっと面倒くさいんだよなあ。" userName="jokoon" createdAt="2025/05/04 11:04:08" color="">}}




{{<matomeQuote body="”import geopandas”なんて前からあるじゃん。皮肉抜きにして、DuckDBの何が特別なの？著者には具体的な例を見せて欲しかったな、そしたら彼らの主張をもっと理解できたのに。" userName="larsiusprime" createdAt="2025/05/03 21:28:25" color="">}}




{{<matomeQuote body="DuckDBについて調べてるんだけどさ、技術的なメリットはたくさんあるけど、一番の強みは使いやすさだと思うんだ。sqliteみたいな手軽さに、高い拡張性と分かりやすいドキュメントがある。<br>今のDevOps界隈は、ひどいSaaSとか古いOSSのセットアップにうんざりしてる人が多い。DuckDBは成熟した選択肢として出てきたから、趣味で使う人たちの間でファンが多いんだろうね。（規模が大きくなると、また別の考慮が必要になるかもだけど）。" userName="tmpz22" createdAt="2025/05/03 22:27:16" color="#38d3d3">}}




{{<matomeQuote body="著者だよ。何が特別かって、データジェネラリストが今使ってるツールで、あっという間に空間データを扱えるようになることなんだ。これが地理空間データ触る人の層をめちゃくちゃ広げると思うんだよね。（Geopandasも素晴らしいツールだけどね。）" userName="dbreunig" createdAt="2025/05/03 22:18:49" color="#45d325">}}




{{<matomeQuote body="DevOpsな人たちの間での採用状況ってどうなの？まだ多くの開発者がSQLの読み書きに慣れてないってフィードバック聞くんだよね。学校で簡単なSELECT文は習ったけど、JOINとかGROUP BYとかになると混乱するらしい。" userName="wenc" createdAt="2025/05/04 00:02:55" color="">}}




{{<matomeQuote body="他のコメントにも返信したんだけど、DuckDBのデカい特徴は、spatial拡張が標準的なfoss gisパッケージ（GDALとかPROJデータベースもバイナリに組み込んでる）をSQLインターフェースで提供してることかな。だから依存関係がほぼlibcだけなんだよね。もちろん、DuckDB自体はベクトル化実行とかカラムナストレージとか、それ以外の拡張機能もある。<br>僕はspatial拡張の性能向上とかに注力してるけど（新しいジオメトリエンジンとか空間結合最適化もマージされたばっかり）、GDAL使って色んな地理空間形式に変換したり、SQLで変換したりできるのが、QGISアップデートしただけでワークフローが壊れたりしないっていうのが、初期採用者には一番のキラーフィーチャーだったと思うよ。<br>（免責事項：僕はduckdblabsでduckdb-spatialの開発をしてるよ）" userName="maxxen" createdAt="2025/05/03 22:31:45" color="#45d325">}}




{{<matomeQuote body="君の使い道（ST_Distance）なら、おそらく違いはないと思うよ。<br>もしPostgresにデータがすでにあるなら、PostGISを使い続けた方が良いね。<br>僕の場合は、大規模なデータで使うときの速さでDuckDBを使ってるんだ。<br>ディスクに600GBのlat-longデータがParquetファイルで置いてあるんだけど、もしPostGISを使いたかったら、まずこの全データをPostgresに取り込まないといけなくなる。<br>DuckDBだと、文字通りJupyter notebookを開いて10秒もかからずにこれができるし、結果は一瞬で返ってくるんだよ（事前にデータを取り込む必要はなし）。<br>（コード例省略）" userName="wenc" createdAt="2025/05/04 00:12:29" color="#45d325">}}




{{< details summary="もっとコメントを表示（1）">}}

{{<matomeQuote body="これ以上深くSQLを学ぶ意味はもうないね、AIアシスタントがSQLクエリの問題をほぼ解決してくれたよ。<br>自然言語で自分が欲しいものを聞くだけで良いんだ。" userName="vasco" createdAt="2025/05/04 05:02:34" color="">}}




{{<matomeQuote body="このパターン（そして、duckdbを使ってみたんだけど）がいまだによく理解できてないんだ。<br>そのファイルを一生のうちで一度か二度しかクエリしないならともかく、postgresにインポートするのにそんなに時間はかからないはずだし、そうすればDuckDBでできることと同じかそれ以上のことができるんじゃない？<br>あと余談だけど、みんなDuckDBをインメモリだけで使ってるの？<br>だって複数のセッションが必要になったら、ローカルデータベース上でDuckDBを使うと思うんだけど、そうするとまた利点が分からなくなるんだ。<br>ただ、僕が何か見落としてるのは確かだろうな。" userName="vasco" createdAt="2025/05/04 05:00:51" color="">}}




{{<matomeQuote body="＞postgresにインポートするのにそんなに時間はかからないはず<br>通常、新しいデータは定期的に生成されるもので、postgresに取り込むには別途ETLプロセスを作成する必要があるんだ。<br>DuckDBだとETLは不要。<br>新しいParquetファイルはディスクから読み込まれるだけだよ。<br>＞みんなDuckDBをインメモリだけで使ってるの？<br>DuckDBは通常シングルユーザーとして使われてて、そう、インメモリの使い方が一番多いね。<br>シングルユーザーが複数のセッションを必要とする使い道についてはよく分からないけど、DuckDBは読み込みの同時実行やセッション分離などは備えてるよ。<br>書き込みのシリアライズは複数セッションでサポートされてると思う。<br>Parquetファイルは追記専用だから、「書き込み」の使い道はより限定される傾向があるね。<br>通常、別のプロセスがそれらのParquetファイルを生成して、DuckDBはただそれを扱うだけなんだ。" userName="wenc" createdAt="2025/05/04 06:12:56" color="#45d325">}}




{{<matomeQuote body="＞通常、新しいデータは定期的に生成される<br>この部分は明らかじゃなかったね。<br>多くの場合、ジオデータはほぼ安定していて、追記よりも読み込みや検索の方が主なんだ。<br>だからこそ、僕たちはそれをDB（大抵postgisだけどね）に置いているんだよ。<br>だからDuckDBは全く異なるユースケースに最適化されていて、それが言及される時にいつも明らかじゃないのは当然だね。" userName="indeyets" createdAt="2025/05/04 08:35:14" color="#785bff">}}




{{<matomeQuote body="＞大きな部分は、duckdbsの空間拡張が、一連の標準的なfoss gisパッケージ全体に対してSQLインターフェースを提供していることだ。<br>全てを静的にバンドルして（デフォルトのPROJデータベースの座標系をバイナリにインライン化することも含めて）、複数のプラットフォーム（WASM含む）で提供しているからだよ。<br>つまり、libc以外の推移的な依存関係はないんだ。<br>そしてこの20年間、10年どころか、これを先駆けてみんなが慣れるように教えてきたのはPostGISなんだ。<br>GISの世界ではDuckDBなんて人が知ることすらなかった。<br>QGISがDuckDBに接続できるかどうかも定かじゃないし（もしかしたら最近できるようになったかもしれないけど）、Spatialiteのことは昔からずっと知られてる。<br>そして最後に、ESRIはマジでまだDuckDBのことを聞いてないはずだ。<br>これでもうジオ空間世界の半分は占めてるんだ。<br>この記事全体が素晴らしく偏っていて、とても悲しいよ。" userName="larodi" createdAt="2025/05/04 20:38:59" color="#ff5c5c">}}




{{<matomeQuote body="それで、外部ファイルに実際にインデックスを付けて（この600GBを超えるクエリを速くして）、このインデックス（または多数のインデックス）を永続化する方法があるのか気になるね。<br>ドキュメントを見た時にそれを見落としていたのかもしれないけど…" userName="touisteur" createdAt="2025/05/04 10:18:28" color="">}}




{{<matomeQuote body="全く同意しないな。<br>SQLクエリは正確さが非常に重要な分野の一つだよ。<br>なぜなら、下流のアプリケーションはそれが正確であることを前提としてるからね。<br>もしクエリを間違えたら、特にETLプロセスでは、長期間大量のゴミデータを生成する可能性があるんだ（実体験から話してる）。<br>修正するのに時間がかかるかもしれないし（データの入れ直しとか）、元のデータがもう利用できないこともあるんだ。<br>複雑なSQLを書くアイデアを生成するためにLLMを使うことはあるけど、デプロイする前には必ず100%クエリを理解する必要がある。<br>間違いは高くつくし、時には元に戻せない。<br>信頼するけど検証する必要があって、それには深いSQL知識が必要なんだ。<br>正確なSQLを書くには、構文を知ってるだけでなく、スキーマ（LLMに簡単に提供できる）と期待されるデータ値（サンプリングをLLMに提供するのは役立つけど、ドメイン知識はもっと役立つ）も知ってる必要があるんだ。<br>データには視覚的な検査でしか明らかにならない驚くようなことがたくさんあるんだ。（MCOを使えば、LLMがデータベースをサンプリングしてデータ自体を検査できるようになる日が来ると思うけどね）" userName="wenc" createdAt="2025/05/04 06:24:12" color="#45d325">}}




{{<matomeQuote body="いや、実際彼ら（ESRI）も知ってるよ。<br>（リンク省略）" userName="maxxen" createdAt="2025/05/05 08:52:12" color="">}}




{{<matomeQuote body="lat/lonsの保存や操作だけなら、GeoParquet使う強い理由ってあるのかな？普通のparquetじゃダメ？圧縮率がもっといいとか？みんな圧縮率いいって言うけど、.shpとかと比べてるだけみたいだし、普通のparquet（.gz.parquetとか.snappy.parquet）でも結構いい感じに圧縮できるんだよね。だから、GeoParquetを調べるのに時間かけるべきかよく分かんないんだよね…。今は主にsparkとたまにclickhouseで普通のparquetを処理してる感じだよ。" userName="Amadiro" createdAt="2025/05/04 09:40:21" color="#785bff">}}




{{<matomeQuote body="DuckDBは書き込みがシングルプロセスだから、ログみたいに同時大量書き込みには向かないよ。それより、地理空間みたいなローカルで計算する特定のデータサイエンスワークロードに軽量ツールとして使うのが得意なんだ。SQLスキルは必須じゃないって意見だけど、DBの基本理解は必要だよ。LLMsとか使ってクエリを改善できれば十分だと思うけどね。" userName="tmpz22" createdAt="2025/05/04 13:22:53" color="#ff5733">}}




{{<matomeQuote body="データがParquet形式なら、ある意味もうインデックスみたいになってるんだよね。だから、それ以上のインデックスは要らないかな。DuckDB独自のフォーマットで保存するなら（僕は使ってないけど）、最新のインデックスをいくつかサポートしてるみたいだよ。https://duckdb.org/docs/stable/sql/indexes.html<br>でも、僕的にはParquetで十分速いと思うけどね。" userName="wenc" createdAt="2025/05/04 17:57:11" color="">}}




{{<matomeQuote body="強いSQL知識って、いつから開発者のコアスキルじゃなくなったの？フロントエンドとバックエンドで専門化が進んだのが原因なのかな？" userName="Yeroc" createdAt="2025/05/04 01:25:14" color="">}}




{{<matomeQuote body="これ、すごくいい返信だね。記事がこうだったらよかったのに。ありがとう！" userName="larsiusprime" createdAt="2025/05/03 22:41:36" color="">}}




{{<matomeQuote body="いいところの一つは、あのクソみたいなpandasのAPIがないことだね。" userName="tsss" createdAt="2025/05/03 22:36:29" color="">}}




{{<matomeQuote body="DuckDB使ったことないけど、本当の比較対象はきっとpostgisだよね？記事には出てこないけど、著者が言いたいのはそれだと思うんだ。pandasとかgeopandasに特に不満はないんだけど、現実的に唯一の解決策の時しか使わないかな。好きでライブラリとして使ってるわけじゃないし。これってpandas（かそれに似たもの）とデータベースを比べてるってことなのかな？" userName="joshvm" createdAt="2025/05/03 22:17:04" color="#ff33a1">}}




{{<matomeQuote body="SQLクエリの最適なパフォーマンスを出すのは科学より芸術だよ。LLMが動くクエリは作れても、最適なのは難しい。分析の一回きりならいいけど、スケーラビリティ考えるなら、ちょっとした調整がすごく大事になるんだ。" userName="rotten" createdAt="2025/05/07 13:22:01" color="#45d325">}}




{{<matomeQuote body="これはより典型的なユースケース（静的データ、ヘビーリード）で、DuckDBは完全にこのユースケース向けに最適化されてるんだ。DuckDBはベクトル化されてて、並列処理エンジンも提供してるよ。クエリを実行すると、htopで僕の32コア全部が活発になるんだ。" userName="wenc" createdAt="2025/05/04 15:35:31" color="#ff5c5c">}}




{{<matomeQuote body="AIアシスタントはやり方のアイデアをくれるけど、「学ぶ必要はない」っていう主張にはマジで反対だね。AIの提案がすごく変だったり、間違ってたりする可能性あるから、ちゃんと理解しないとダメだよ。（もしハルシネーションしても、構文エラーは気付くだろうけど、それは学ぶこととは違うしね…）" userName="usr1106" createdAt="2025/05/04 05:53:02" color="#ff5733">}}




{{<matomeQuote body="duckdbはParquetをサポートしてて、SQL構文でめちゃくちゃ大量のParquetファイルに広がった巨大なテーブルを、まるで一つの仮想ファイルみたいに扱えるんだ。その裏には、Parquetでベクトル命令を活用できるチャンスがあると思うんだよね。すっごく便利だよ。" userName="jjtheblunt" createdAt="2025/05/03 22:37:40" color="#ff5c5c">}}




{{<matomeQuote body="DuckDBの全部が特別なんだ。Pandasは表形式データ分析の最先端からはかなり、かなり遅れてるよ。" userName="getnormality" createdAt="2025/05/03 22:32:04" color="">}}




{{<matomeQuote body="これってさ、SQLから出てくるデータは間違ってる可能性が高いって考えるべきってことだよね、だって書いてる多くの人が深い知識持ってないし、正解がないかあっても限られてるから結果の正しさを検証するのってすごく難しいじゃん。もし多少なりとも混乱が生じるってすでに予想してるなら、設定にAIも組み込んじゃえばいいんじゃない？" userName="8note" createdAt="2025/05/05 00:09:26" color="">}}




{{<matomeQuote body="SQLがコアスキルだったかは不明。多くの開発者は日常使わず忘れやすい。僕は大規模データでMLモデルを扱うから体に染み付いたけど、まともに使えるまで試行錯誤したよ。多くの開発者は仕事で触れる機会が少ないから練習量が足りないんだと思う。" userName="wenc" createdAt="2025/05/04 06:34:54" color="">}}




{{<matomeQuote body="DuckDBはストレージエンジンじゃなくて、分析エンジンとして考えるのがいいよ。OLTPじゃなくてOLAPだね。" userName="wenc" createdAt="2025/05/04 17:31:52" color="#785bff">}}




{{<matomeQuote body="ちょっと言わせてもらうとね、みんなもっとSQLをうまくやるべきだよ。9個もJOINしたり、GROUP BYとかHAVINGとか他のすごい機能じゃなくていいんだ。でも、2つくらいのJOINとGROUP BYは絶対できた方がいい。もし3NFをすでに理解してるなら、JOINとか他の機能はすぐに（2週間くらいで）覚えられるさ。DuckDBの道を行く前に、そっちを選ぶね。" userName="edoceo" createdAt="2025/05/04 00:25:42" color="">}}




{{<matomeQuote body="地理空間アプリ開発してる者だけど、 Feltが一番期待してる。開発者が認証とかを制御できるようツールを拡張してほしいね。<br>この分野はニッチで、座標系とか学ぶのが大変。自分で作ったマッピングツールをFeltに置き換えて、コアプロセスに集中したい。ブラウザ表示のコードは維持が大変なんだ。<br>DuckDBのDXはPostGISと同じだよ、って他の人も言ってたね。" userName="jparishy" createdAt="2025/05/03 22:06:12" color="#45d325">}}




{{<matomeQuote body="著者です。DuckDB spatialの良さは、投影法やCRSが必要になるまで隠されてること。90%の利用ではこれらを知る必要ないです。<br>本格的な地理空間作業には素晴らしいツールはたくさんあります。Feltも大好きです！でもマップは不要で列として欲しいだけの場合も多い。PostGISも素晴らしいけど、サーバー起動が必要でカジュアルじゃない。<br>DuckDBの良さは、すぐに使えてデータ一般論者でも手が届くことです。" userName="dbreunig" createdAt="2025/05/03 22:16:31" color="#45d325">}}




{{<matomeQuote body="私の経験では、データ一般論者は空間参照の重要性を理解してないから地理空間分析はやめるべき。多くの失敗を見てきたよ。例：再投影にhavsine関数使う、WGS84とNAD27を空間結合、Mercator図法でミサイル射程外判断など。<br>DuckDBは良いけど、一般論者が地理空間データで間違いやすいのは欠点だよ。" userName="korkoros" createdAt="2025/05/03 23:04:19" color="#45d325">}}




{{<matomeQuote body="GISの授業で悪名高いミサイル脅威地図について学んだのを覚えてるよ - https://georeferenced.wordpress.com/2014/05/22/worldmapblund...<br>https://www.economist.com/asia/2003/05/15/correction-north-k..." userName="groggo" createdAt="2025/05/04 01:09:57" color="">}}




{{<matomeQuote body="フロントエンドの地図表示ってホント難しいんだよね。それが一般アプリに広がらない理由だと思う。バックエンドは簡単にできることが多いのに、良いツールがたくさんあるし。でも、地図表示のフロントエンドはマジで地獄で、使える既製のソリューションが見当たらないんだ。低レベルすぎたり、高レベルすぎたり。<br>隠蔽してアプリ開発者がコア機能に集中できるような、GIS-liteみたいな埋め込み可能なツールが必要だと思うよ。マップのデバッグでフロントエンド開発者が無限に時間を費やすのをなくさないとね。<br>編集：言い直すと、地図の価値をリーダー層に分かってもらって、アナリストでも地理空間の作業ができるようにすることと、フロントエンドアプリに地図表示ツールが増えて、リーダーがそれを見て地理空間がなぜ重要か理解することには関係があると思うんだ。単にマーカーを置くだけじゃなくて、広く見てもらえるようにする必要がある。だからウェブのフロントエンドに注目してるわけ。話が飛躍したように感じたらごめんね。" userName="jparishy" createdAt="2025/05/03 22:25:34" color="#ff5c5c">}}




{{<matomeQuote body="前回確認したとき、DuckDB Spatialは投影法を扱えなかったんだよね。.prjファイルからCRSを読み込めない。これじゃ、ちゃんと地理空間を扱うには使えないよ。" userName="febed" createdAt="2025/05/05 00:21:55" color="#785bff">}}

{{</details>}}




{{< details summary="もっとコメントを表示（2）">}}

{{<matomeQuote body="＞座標系とか投影法とか変換とかをみんなに覚えるのに、たくさんのトレーニングが必要だ<br>適切な楕円体参照系と計算幾何学の実装、インデックスがあれば、これはほとんど全部避けられると思うんだ。地理空間分析のほとんどは地図作成のためじゃないんだよ。地図はせいぜい表示する層であって、データモデルじゃないし、地図を全く使わない人もいる。直感的な地理空間の関係についての簡単な質問をするのに、分かりにくい専門的な地図作成システムを学ぶことを強いるのは、大きな問題の一部だね。これを学習曲線の一部にする必要は全くないんだ。<br>僕はこれを何度か、詳しくないユーザー相手に実験してみたことがあるんだ。完全な楕円体のWGS84実装を地理空間分析に使わせたら、地球上のどこでも、地理空間の範囲に関係なく、だいたい”それっぽく”動くんだよ。確かにソフトウェアの実装はかなり難しくなるけど、ユーザー体験としては圧倒的に優れてる。だって、世界が人々が直感的に考えるように振る舞うから、投影法とか変換とかについて何も知らなくて済むんだ。正直言って、投影法とか変換を知ってたとしても、結果が最適じゃないことも多いんだよ。<br>唯一出てくる問題は、地図表示ツールキットの多くが、グローバルデータモデルやたくさんの複雑な形状があると、ちょっとおかしくなること。レンダリングの問題がたくさん出るんだ。これも解決すべきことだろうけどね。" userName="jandrewrogers" createdAt="2025/05/04 00:22:43" color="#ff33a1">}}




{{<matomeQuote body="同意したいところだけど、残念ながらこの分野の既存データや処理の膨大な量は楕円体地球を前提としておらず、CRS付きで提供されてるんだよね。結局のところ、都市計画とか、意図的に楕円体の意味論で解釈したくないデータがある分野もある。その場合は地図がデータモデルであって、間違いなく三角形の角度の合計が180度になるようにしたいもんね。" userName="maxxen" createdAt="2025/05/04 00:59:08" color="#785bff">}}




{{<matomeQuote body="同じように、これらの問題（投影法とか）に遭遇するのは避けられないと思うんだ。もし詳細に慣れてないと、デバッグに表面的な理解以上のものが必要になるから、大きな障害になる。逆に、問題があること自体を知らないと、コードが壊れたままになる。全体を抽象化しすぎるのは、僕が上で言った「高レベルすぎ」ってことだけど、それが単純な解決策だとは全く思わないんだ。正直、正しい答えはまだ分かんないけど、誰か見つけたら、それは破壊的な変化になるだろうね。" userName="jparishy" createdAt="2025/05/04 01:17:42" color="#45d325">}}




{{<matomeQuote body="＞ソフトウェアの実装はそれほど難しくない<br>ほとんどの地理空間ツールって、単純な幾何学をやってるだけじゃないの？だから、何らかの投影法上で動く必要があるんじゃないの？<br>楕円体モデルで計算できれば、結果は良くて直感的ってのは分かるけど、計算はもっと複雑になるよね。今のQGISとかGDALみたいなツールで、実際にそれができるの？" userName="groggo" createdAt="2025/05/04 01:06:02" color="">}}




{{<matomeQuote body="言わせてもらうと、ほとんどのデータには球面アプローチは使えないんだよ。実際には、点にしか使われてないのが現実。ポリゴンはもちろん、ラスタみたいなものになると、空間データはそもそも球面アプローチを許さない方法で保存/生成されてるからね。それを元に戻すのは不可能なことが多いか、せいぜい大変なだけ。そしてラスタは根本的にその方法で表現するのは不可能。<br>分析はだから投影法を使うんだよ。球面アプローチは、ほとんどのユースケースで根本的に”より良い”わけじゃない。全てが点データなら、それは間違いなくより良いんだけど。<br>地理空間には、点データセット以上のものがあるんだよ。" userName="jofer" createdAt="2025/05/04 14:34:01" color="#38d3d3">}}




{{<matomeQuote body="良い指摘だね。確かにラスタ分析では意味がないね。<br>でも、あらゆる種類のベクタデータは、点、形状、線、球面上にモデル化できるんじゃないの？そして”より良い”って言ったのは、たとえ最も適した投影法でも少し歪みがあるから、って意味だよ。<br>どちらにせよ、ほとんどのものは平面幾何学を使うから投影法は必要で、その仕組みがどう動くのか、ある程度理解する必要があるんだよね。" userName="groggo" createdAt="2025/05/04 19:44:06" color="#45d325">}}




{{<matomeQuote body="ポリゴンを球面上にモデル化することはできるんだけど、問題はあなたが使おうとしているデータが既にカルテシアン表現になってるってことなんだ。国際日付変更線や極を越えるような複雑なジオメトリの場合、実際にはその間で簡単に変換することはできないんだよ。だから、点以外のものを扱うのは実際には難しい。最初から球面表現でデータをネイティブに生成するなんて、めったにないことだからね。" userName="jofer" createdAt="2025/05/04 22:18:25" color="#38d3d3">}}




{{<matomeQuote body="多くの人が単純なジオメトリを使うせいで、専門家じゃない人たちはめちゃくちゃ困ってるんだよ。そんなの予想してないからね。ちゃんとした地理空間ツールは大抵、楕円体モデルに対応してるけど、それがデフォルトじゃないのが問題。明示的に指定しなきゃいけない（みんなそれがデフォルトだと思ってる）。さらに、楕円体実装ってあんまり最適化されてないんだ。デフォルトじゃないからかな。だから有効にすると突然パフォーマンスがひどくなる。そうなるとみんな「楕円体実装は激遅い」って信じ込んじゃうけど、実際は病的に遅い実装を使ってるだけなんだ。ちゃんとパフォーマンス考慮して作られた楕円体実装は、オープンソースの遅い実装を見てみんなが思ってるよりずっと速いんだよ。" userName="jandrewrogers" createdAt="2025/05/04 04:08:40" color="#45d325">}}




{{<matomeQuote body="これって別に問題じゃないよ、3D空間の軌道や物理シミュレーションでもやろうとしてない限りはね。地理情報システムから地理シミュレーションシステムへの境界線はちょっと曖昧だけど、投影座標系での計算や投影は、距離、面積、経路探索みたいな典型的な多くの質問には十分なんだ。ただ、トポロジーサポートみたいになってくると話は専門的になってきて、ユースケースもニッチになるね。GEOSがサポートしてる範囲を超えた効率的な計算をデータベース ストレージレイヤーに求めるのは、ちょっと高望みしすぎだと思うな。そういう段階になったら、関連データを高レベルのアプリケーションにインポートするのがいいんじゃないかな。" userName="Demiurge" createdAt="2025/05/04 02:19:48" color="">}}




{{<matomeQuote body="僕自身はシミュレーションシステムの話をしてるわけじゃないよ。これは多くのオペレーション向け地理空間データモデルで標準的な要求で、業界にはたくさんあるんだ。投影座標系で動くものはもうダメ。大規模な地理空間分析とか、ある程度の精度が必要な場合に、これは明確な問題を引き起こすんだ。効率的な計算っていうのは、ただ効率的なコードってことで、OSSでも書こうと思えば書けるのに、それが存在しないだけ。確かにデータモデルが地理的にもデータサイズ的にも小さければそれで逃げ切れるかもしれないけど、全ての会社がそうじゃない。データベースでこれをやるのは十分に可能だよ。むしろ実際そうやってるんだ。GEOSの限界はソフトウェアの限界じゃない。あれは別に洗練された実装じゃないし（最後に確認した限り、PostGISですら重要な部分には使ってない）。ある意味、あなたはOSSのこの分野には野心がないってことを認めてるんだと思うよ。" userName="jandrewrogers" createdAt="2025/05/04 04:25:29" color="#45d325">}}




{{<matomeQuote body="GEOSが特に洗練されてないって言うのは、ちょっと違うと思うな。多くの（もちろん全部じゃないけど）GEOSアルゴリズムはJTSから移植されてて、そのJTSの主要開発者はMartin Davis（Dr JTSとも呼ばれる）で、彼はPostGIS拡張を提供してるCrunchy Dataで働いてるんだ。だからチェーンは（大体の場合）JTS -＞ GEOS -＞ {PostGIS, Shapely} -＞ …って感じ。Martinの仕事はオープンソースのGIS向け計算幾何学の最先端だし、長いことそうだよ（もちろん、業界には独自のツールもあるけど、それは今話してることじゃない）。グローバルな楕円体ジオメトリのメリットについては、ユーザー視点からすればある程度分かる気もする。でも、ジオメトリ計算が遅いし（「本質的に」って言いたくなるけど…）、実装がずっと複雑（球座標系で高速で正確な r- または r*-tree 書くのがどれだけ大変か見てみてよ）なのはどうしようもない事実なんだ。それは当分変わらないだろうから、投影ワークフローもおそらくなくならないだろうね。" userName="urschrei" createdAt="2025/05/04 11:16:16" color="#ff5733">}}




{{<matomeQuote body="データベース関数経由でAPI公開すれば何でもできる、っていうのは君の言う通りだね。だけど、みんなが言うように…「できるからやるべきか？」って問題がある。より洗練された多次元計算ができるようになればクールなのは同意するけど、僕は何年もいろんなプロジェクト、中には正確なシミュレーションを含むものもやったけど、そんなの必要になったり、やりたいと思ったりしたことはほとんどないな。実際には、データベースはデータの保存とクエリのためにあるんだ。それは超正確にできる。僕はたぶんSQLをめちゃくちゃ乱用するタイプだけど、3D ECEF回転のコードをSQLで書いたこともあったけど、それは締め切りに間に合わせるためのハックであって、正しいやり方だったからじゃない。僕が関わったプロジェクトは全部、外部にモデルとかコンポーネントがあって、そこで「正確な作業」を複雑なコードでやってたんだ。それをどのデータベースにも依存させようとは思わなかったな。正直、気になるんだけど、君がやってる分析でNAD83とかUTMじゃ精度が足りないのって、どんな分析なんだ？本当に「現実世界」の地理空間データ？土壌モデルなら、すごくローカライズされた分析だし、地球規模の気候モデルなら、グリッドセルのサイズはキロメートル単位の話になる。どの場合も、収集されたデータには大抵のまともな投影よりずっと大きいジオロケーションの誤差が組み込まれてるんだ…だから、何千キロのグローバルスケールでセンチ単位の精度が必要な分析って、何をしてるの？すごく面白そうだね。僕がそれを見た唯一のケースは、誤差が将来に向けて本当に蓄積していく宇宙飛行シミュレーションくらいだよ。" userName="Demiurge" createdAt="2025/05/04 13:36:53" color="#785bff">}}




{{<matomeQuote body="https://geobase.app/ 試した？彼らも最近DuckDB連携の記事出してたよ：https://geobase.app/blog/duckdb-1-1-3" userName="kashifr" createdAt="2025/05/04 11:03:22" color="">}}




{{<matomeQuote body="試したことなかったよ、すごく良さそうだけど、僕が考えてる問題とは逆のことを解決してるみたい。僕はバックエンドに依存しないフロントエンドのツールセットで、GISとして自分のニーズに合わせてカスタマイズできるものが欲しいんだ。自分でツールを実装するのは低レベルすぎ。サービスにデータを管理・制御・所有されるのも高レベルすぎ。まだ、そのちょうど良いところが実現されてないと思うな。" userName="jparishy" createdAt="2025/05/04 20:06:48" color="">}}




{{<matomeQuote body="なぜって？記事が詳しいこと何も言ってないんだもん。SQLと空間解析を組み合わせるのは最高だし、めっちゃ自然だよ。RDBMSの視点から見れば、2Dジオメトリはfloatやstringと大差ない、特別な演算子とかインデックスが付いただけの別のカラム型だよ。PostGISとかSpatialiteで、もう20年も前からやってることだしね。DuckDBがすごいのはクラウドネイティブなフォーマットに対応してること。ディスクじゃなくてオブジェクトストレージにくっついてる標準の地理空間機能なんだ。だからDBプロセス動かす必要ないし、データはいつも「”at rest”」でHTTP経由で使える。これ、成果を低く見てるわけじゃないよ、すごく便利だしね。でも、これは既存の技術をクラウドのIO環境で効率よく動くように再パッケージしただけだって知っておいてほしいな。もし何か大きな革新があるとしたら、地理空間そのものじゃなくてデータ管理の分野だと思うよ。" userName="perrygeo" createdAt="2025/05/04 15:38:54" color="#ff5733">}}




{{<matomeQuote body="主張はけっこう分かりやすかったと思うけどな。もっと手軽なツールになれば、使う人や協力してくれる人も増えるってことだよ。でも、専門家（apparent SME）みたいだから、タイトルに釣られたって感じちゃうのも無理ないかもね。" userName="mpalmer" createdAt="2025/05/04 15:48:34" color="">}}




{{<matomeQuote body="主にハッキリさせたいのはね、DuckDBが地理空間で何か新しいことしてるわけじゃないと思うんだ。これはデータ管理とデータアーキテクチャの新しい考え方なんだよ。この違いを理解するのはマジで大事。DuckDBは浮動小数点数も扱うけど、それってDuckDBが浮動小数点データで一番大事ってこと？違うじゃん。変わったのは根本的な計算環境。そこにイノベーションがあるんだよ。技術記事書く人は、この決定的な違いをちょっと時間かけて明確にしてくれるとありがたいな、正確に書くのって難しくないし、わざとあいまいな技術記事出して何が良いのか分かんないよ。" userName="perrygeo" createdAt="2025/05/04 17:10:17" color="#ff5733">}}




{{<matomeQuote body="「”install geospatial”」が「”pip install geopandas”」と比べて、シンプルさでゲームチェンジャーだっていう主張には同意できないかもな。どっちも一行じゃん。" userName="wodenokoto" createdAt="2025/05/03 21:09:55" color="">}}




{{<matomeQuote body="一番大きいのは、duckdbs spatial extension には他の依存関係（libc以外）がほぼないってことかな。標準のfoss gisツール一式（座標系のDBも全部含めて）をいろんな環境（WASMもね）向けにまとめてパッケージして、それを全部統一されたSQLインターフェースで使えるようにしてるんだよ。（ちなみに、私 duckdb-spatial @duckdblabs の開発チームにいるよ）" userName="maxxen" createdAt="2025/05/03 22:12:32" color="#ff5c5c">}}




{{<matomeQuote body="趣味のプロジェクトで duckdb-spatial 使ってみたんだけど、geopandas と比べて一番の収穫はバッチ処理のパフォーマンスだね。空間解析をSQLで書いて、ちょっと最適化すれば、duckdbはCPUとかメモリを使い切ってものすごく速く処理してくれる。Pythonスクリプトじゃあそこまでなかなかできないんだ。静的リンクも良いね。Pythonで reproducible environments 作る時の問題解決に役立つし。でも、それはゲームチェンジャーってほどじゃないかな、個人的にはね。" userName="jessekv" createdAt="2025/05/04 11:43:47" color="#785bff">}}




{{<matomeQuote body="「”アクセシビリティ”」って、あまりにも軽視されすぎだよ。たしかに、色々なツールで色々できるけど、それを人に使ってもらうように仕向けるのは腕前だしアートだよ。ここが、オープンソースっぽいツールとエンタープライズ版の何かとの違いが出やすいところでもあるんだよね。" userName="carlhjerpe" createdAt="2025/05/03 23:20:58" color="">}}




{{<matomeQuote body="「”load extension postgis”」より、そんなにずっと簡単かな？ geos と gdal はいつもちょっと面倒だったのは知ってるけど、Dockerがもう全部隠してくれた感じじゃない？「”docker pull postgis”」ってめちゃくちゃ簡単だし。まあ、duckdbが他に何を提供してるかはあまり詳しくないんだけどさ。" userName="WD-42" createdAt="2025/05/03 21:25:23" color="">}}




{{<matomeQuote body="そうだよ。サーバーを用意することと、CLIで「”install spatial”」って打つことの差は、もう段違いに違うよ。Dockerもかなり改善されたけど（昔、初めてPostGIS覚える時、projのディレクトリ探したりソフトをコンパイルしたりするのにどれだけ時間かけたことか、あれが大きな壁だったんだ）、<br>$ duckdb<br>D install spatial;<br>このコマンドの簡単さには、まだまだ遠く及ばないね。" userName="dbreunig" createdAt="2025/05/03 22:21:54" color="#38d3d3">}}




{{<matomeQuote body="「”サーバーを用意する”」って、どういう意味？それ、すごく変な条件だよ。Postgisはmacbookにコマンド一つでインストールできるし、いや、主要な3つのOS全部にコマンド一つでできるよ：「”brew install postgis”」、「”apt-get install postgresql-postgis”」、それと「”choco install postgis-9.3”」ってね。DuckDBは「”サーバー”」とか「”コンピューター”」が必要ないの？Dockerと何の関係があるわけ？なんか話がすごく混乱する筋道だよ。" userName="Demiurge" createdAt="2025/05/03 23:47:34" color="#ff33a1">}}

{{</details>}}



[記事一覧へ]({{% ref "/posts/" %}})
