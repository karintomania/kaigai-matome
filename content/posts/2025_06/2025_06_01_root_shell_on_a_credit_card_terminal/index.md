+++
date = '2025-06-01T00:00:00'
months = '2025/06'
draft = false
title = 'クレジットカード端末でRootシェル取得に成功'
tags = ["セキュリティ", "ハッキング", "脆弱性", "Root権限", "決済システム"]
featureimage = 'thumbnails/light-orange3.jpg'
+++

> クレジットカード端末でRootシェル取得に成功

引用元：[https://news.ycombinator.com/item?id=44150803](https://news.ycombinator.com/item?id=44150803)




{{<matomeQuote body="安いUSBカードリーダーでも偽のデビット／クレジットカード決済はできるよ。仕様は全部公開されてるし、プロトコルも文書化されてる（IIRC、PDFで5000ページとかあって読むのは大変）。<br>でも、その決済を認証させるにはインターネット経由で銀行に送る必要があって、そうすると連邦警察とかFBIとかの訪問を受けることになるよ。<br>カードリーダーには本当の保護はない（大半はLinuxでしょぼいパスワード）。保護は店と銀行の間の契約や規制から来てるんだ。" userName="Disposal8433" createdAt="2025/06/01 16:16:10" color="">}}




{{<matomeQuote body="現場のカードリーダーがハッキングされて、キャッシュされたり保存されたりしてる本物のクレカ詳細を読み取られたり、マルウェアを仕掛けられたりする方がもっと心配だな。（今回の特定ケースでは難しそうだけど、この分野の研究が関係あるってことだね。）" userName="csinode" createdAt="2025/06/01 16:33:06" color="">}}




{{<matomeQuote body="今どきのクレジットカードって、基本的に物理的な秘密鍵みたいなもんじゃないの？ IIRCだと、決済は一回きりのペイロードで、その操作専用に署名されるから、傍受しても役に立たないはずだけど、僕のカードの仕組みについての理解が間違ってたらゴメン。" userName="rockbruno" createdAt="2025/06/01 16:45:08" color="">}}




{{<matomeQuote body="＞ カードリーダーには本当の保護はない（大半はLinuxでしょぼいパスワード）。<br>そんなことないよ。署名済みバイナリしか動かせない、実行可能なファイルシステムは読み取り専用、データ用ファイルシステムはnoexecビットがセットされてる、rootログインは無効、機能が削られたbusybox、鍵は起動時にセキュア領域から読み込む、マスターキーの注入は工場出荷時だけ、起動自体も多かれ少なかれ安全、不正開封検出でチップは初期化される、とかね。<br>まあ、EMV認定されてないアジアから輸入された安いAndroid端末なら、多分標準的なLinuxで、rootファイルシステムは書き込み可能、rootログイン有効だし、アプリ実行ユーザー向けにsudoも有効、不正開封検出なし、画面キャストもロックされてない、ポートは全部開けられるし、busyboxも結構使えるやつだろうね。<br>ソース：俺。カード取得用のEMVアプリを何年か開発してた（今も時々やる）。開発モード（ベンダーが開発者のIDを要求）でさえ、これらはすごくしっかりロックダウンされてるんだ。" userName="lelanthran" createdAt="2025/06/01 18:57:33" color="#785bff">}}




{{<matomeQuote body="最近変わってなければ、それはNFC決済とチップ決済にしか当てはまらないよ（スキミングを避けるためにも常にそっちを選ぶべき）。昔ながらの磁気ストライプ決済には関係ないんじゃないかな。" userName="weaksauce" createdAt="2025/06/01 19:50:34" color="">}}




{{<matomeQuote body="まあ、そうだけど、もしカードリーダーを制御できたら、金額を表示せずに決済金額を増やしたり、例えば違うアカウントに送金したりできるかも。" userName="literalAardvark" createdAt="2025/06/01 16:50:34" color="">}}




{{<matomeQuote body="今どき磁気ストライプなんてまだ誰か使う？チップなしのクレジットカードなんて10年以上見てない気がするし、端末はずいぶん前からチップを読めるようになってるよ。この前、磁気不良で店が磁気ストライプを使おうとした時も、チップを使わないってだけで決済拒否されたよ。" userName="cesarb" createdAt="2025/06/01 21:09:06" color="">}}




{{<matomeQuote body="端末リーダーから勝手に全然違うアカウントに送金なんて絶対無理だよ。<br>銀行は誰でもクレジットカード決済を送信して、勝手なアカウントに送れるようなガバガバなプロトコルは使ってない。<br>不正請求の費用はクレジットカード会社が負担するんだから、そんな簡単に起こせるようにはしないさ。" userName="Aurornis" createdAt="2025/06/01 17:23:27" color="#ff33a1">}}




{{<matomeQuote body="ほとんどのPOS端末って、「オフライン」決済を受け付けなくなったと思ってたけど。" userName="Toritori12" createdAt="2025/06/01 16:59:04" color="">}}




{{<matomeQuote body="今はそうかもだけど、特にアメリカ以外では、クレジットカードとデビットカードの境界線がかなり曖昧になった今、ね。<br>10年くらい前、イギリスのレストランでAMEXカードでオフライン決済したのをハッキリ覚えてるよ。<br>あと、機内で決済を受け付ける航空会社のほとんども、端末をオフラインモードで動かしてる。<br>きっとBINコードなんかで、オフライン決済を許可するかどうかのマッピングがあるんだろうね。" userName="sgjohnson" createdAt="2025/06/01 17:05:31" color="">}}




{{<matomeQuote body="契約とか規制で守られてるって話は的を射てるね。非接触カードリーダーで街中歩いて金盗むってトンデモ説がウソなのはこれが理由。たしかに取引自体はできちゃうけど、その後の処理や、それに必要な準備が大変なんだ。それに、取引通知で即バレする人が多いから、捕まる前に金を引き出すのはまず無理だろうね。" userName="miki123211" createdAt="2025/06/01 21:41:45" color="">}}




{{<matomeQuote body="ほんと、ちょうど今週だけで2回も「チップリーダーに問題が」って言われてスワイプさせられたよ（CVSとWegmansで）。" userName="bdangubic" createdAt="2025/06/01 21:24:21" color="">}}




{{<matomeQuote body="「2ドルのUSBカードリーダーで偽のデビット/クレジットカード取引ができる」って話、やり方じゃなくて、もうちょっと詳しく解説してくれないかな？" userName="stef25" createdAt="2025/06/01 18:23:52" color="">}}




{{<matomeQuote body="デバイス買ったらRoot権限は当然欲しいでしょ。支払システムがこんなテキトーなデバイスのローカル権限に依存してるなんて、どんなゴミみたいなリクエスト受けても文句言えないわ。" userName="Y_Y" createdAt="2025/06/01 23:10:41" color="">}}




{{<matomeQuote body="「署名付きバイナリだけ実行、ファイルシステムは読み取り専用、rootログインなし、機能制限付きbusybox、鍵はセキュアエリアから、マスターキーは工場でのみ、起動もセキュア、改ざん検知でチップ消去」とか、色々対策してるのは分かった。じゃあ、その対策破るために誰か雇って攻撃テストとかしたの？脆弱性とか見つかった？" userName="timewizard" createdAt="2025/06/01 19:20:04" color="">}}




{{<matomeQuote body="オフライン決済をサポートするか、いくらまで許すかは加盟店次第だよ。端末は確かに対応してる。取引データは暗号化とかされて安全に保存されるんだけど、端末がネットに再接続するまで。ルール上、オフライン取引の失敗リスクはほぼ全部加盟店が負うことになってるんだ。だから、ほとんどの店はそのリスクを取りたくなくて、オフライン決済機能を無効にしてる。" userName="glitchc" createdAt="2025/06/01 17:34:56" color="">}}




{{<matomeQuote body="セキュリティ攻撃テスト専門の人はウチの会社にはいるよ。業界全体がどうかは分からないけど、EMVアプリケーション開発者でさえ敵扱いするくらいセキュリティは厳しい。認証プロセス自体でも、PIN入力中とかに変なことさせようとする悪意あるテストは少しやるみたい。" userName="lelanthran" createdAt="2025/06/01 19:23:05" color="">}}




{{<matomeQuote body="「取引を検証するために銀行にインターネット経由で送る必要がある」っていうのは全然違うよ。銀行はカード取引処理用のオープンAPIなんてネットに公開してないから。" userName="bogantech" createdAt="2025/06/01 21:12:47" color="">}}




{{<matomeQuote body="たぶんGPさんは勘違いしてるね。安いリーダーでカードの磁気ストライプは読める。暗号化されてないからカード番号（PAN）とか有効期限とか名前は取れるけど、CVVは無理。EMVは暗号化されてるけど鍵が漏れることも。でも、カード読んだだけじゃ取引をネットワークに送る能力は手に入らないよ。それには加盟店の決済ゲートウェイの認証情報とか、店のネットワークに入る必要がある。これは不可能じゃないけど、たとえできても資金は店の銀行口座に入金されるだけで、自分のものにはならない。お金を盗むのは無理なんだ。クレジットカード端末のRoot権限取得が興味深いのは、その後その端末で使われた全カードの詳細を盗めるから。それらの情報を使って、よくあるクレジットカード詐欺ができるようになる、ってことだね。" userName="quesera" createdAt="2025/06/01 23:47:37" color="#ff5733">}}




{{<matomeQuote body="それも考えたよ。触ったことないから、root取れたら何ができるか想像つかないんだよね。" userName="literalAardvark" createdAt="2025/06/01 18:12:20" color="">}}




{{<matomeQuote body="レストランならオフライン決済を受け付けるのが普通だよね。注文した時、カード決済できなくなる可能性なんて知らなかったよ。普段現金持ち歩かないし、もし端末がダウンしたら店の責任だもんね。" userName="sgjohnson" createdAt="2025/06/01 17:38:35" color="">}}




{{<matomeQuote body="＞ If I buy a device it sure as shit better give me root＜br＞実際どうなの？洗濯機とか乾燥機、電子レンジの着信音もう変えまくってるわけ？" userName="fragmede" createdAt="2025/06/01 23:45:41" color="">}}




{{<matomeQuote body="2ヶ月前にAmexとVisaの2枚同時に不正利用された体験談。スキマーかと思ったら、両方使ったサイトはないし。Visaはホテルで使われた通知きて、アプリ見たら別の取引も保留になってた。ホテルに電話したら「客追い出して返金」だって。警察呼ばないのが謎だけど、全部返金されたから損失ゼロで報告することなし…損失はホテル側なのにね。同じ日にAmexも不正利用されたけど、こっちはベンダーが自動返金してくれたみたい（たぶん不正防止で）。変なのは、Visa使われたホテルが「カード現物かデジタルウォレットでの取引」って言ってたこと。でもデジタルウォレットに登録した覚えないしカードは常に持ってた。間違いか嘘か、デジタルウォレット偽装か…。結局、俺がすぐ気づいてカード止めたから犯人は失敗したんだけど。" userName="stephen_g" createdAt="2025/06/01 23:46:22" color="#ff5733">}}




{{<matomeQuote body="USAはchip/tap端末の導入がCanadaに比べて遅かったよね。Apple Payが出てきてからやっとtap対応端末が普及した気がする。" userName="jamwil" createdAt="2025/06/02 00:12:15" color="">}}




{{<matomeQuote body="10年前、飛行機でオフラインのデビットカード決済やったの覚えてる。あの古いエンボス加工のやつでカード通してたんだよ笑" userName="tough" createdAt="2025/06/01 18:01:46" color="">}}




{{<matomeQuote body="＞ Yeah, I did think of that. I’ve never played with one of those so I don’t really have much of an imagination about what they could do with a cracked one.＜br＞デスクにいくつかあるけど、dev-modeでも金盗むことなんてできないよ。" userName="lelanthran" createdAt="2025/06/01 19:01:26" color="#45d325">}}




{{<matomeQuote body="前のコメントで、加盟店情報を丸ごと変えて、もっとアクセスしやすい口座に金を吸い上げられるって言ってる人がいたよ。" userName="literalAardvark" createdAt="2025/06/02 13:40:30" color="">}}




{{<matomeQuote body="＞ unless it’s changed recently＜br＞Europeでは15～20年前に変わったよ。EMV対応端末が必須になって、すぐ磁気ストライプカードの受付はやめたからね。10年前にApple Payが出てからは、カードをスワイプできなくて困るUSの観光客も見なくなったし。" userName="pornel" createdAt="2025/06/01 22:06:27" color="#38d3d3">}}




{{<matomeQuote body="USでは利用可能な技術がAppleが流行らせるまで普及しないのを何度も見るのはいつだってすごいね。" userName="vel0city" createdAt="2025/06/02 02:33:52" color="">}}




{{<matomeQuote body="最近乗った飛行機、機内決済がオンラインになってたっぽいよ。Starlinkとかで常に通信できるようになってるからね。昔から飛行機は通信機能持ってたし、Wi-Fiもあるんだって。飛行機がオフラインな時代はもう終わったみたいだね。" userName="LeonM" createdAt="2025/06/02 08:26:27" color="">}}




{{< details summary="もっとコメントを表示（1）">}}

{{<matomeQuote body="StripeのM2 reader、買って3年で9日しか使ってないのに36台中7台も壊れたんだ。充電できない、NFC使えない、”tampered”って出る。ハードケースで保管してるのに、故障率ヤバいよ。でも他の端末よりマシだから使うしかないんだよね。" userName="joshstrange" createdAt="2025/06/01 16:10:19" color="#45d325">}}




{{<matomeQuote body="バッテリーは充電少ない状態で長く置いとくとダメになりやすいよ。tamperになるのもバッテリー関係してるんじゃない？次使う前にちゃんと充電しといた方がいいよ。" userName="mrbuttons454" createdAt="2025/06/01 16:25:55" color="">}}




{{<matomeQuote body="使う前に充電してるし、イベント前には起動してチェックしてるよ。予備持ってるから助かってる。tamperになったのは同じケースに入ってたから、もしかしたら衝撃かも。でもNFCとか充電の問題は納得いかないんだよね。" userName="joshstrange" createdAt="2025/06/01 16:31:12" color="">}}




{{<matomeQuote body="Stripeの端末、バッテリーじゃない有線のだとどう？POS選んでるんだけど、Stripeも候補なんだよね。有線のヤツは使ったことある？" userName="VladVladikoff" createdAt="2025/06/01 22:23:20" color="">}}




{{<matomeQuote body="もしかして、tamperの状態になった時にRootシェルが開くようになってるんじゃない？セキュアな状態からデバッグ用の状態に切り替わる時に、重要な鍵は消えちゃうとか。" userName="londons_explore" createdAt="2025/06/01 16:04:04" color="#ff5733">}}




{{<matomeQuote body="俺も同じこと考えた！tamper状態になった時に新しい鍵入れたらまた使えるかな？とか。もう使われなくなるなら、中古で探してみようかな。" userName="fp64" createdAt="2025/06/01 16:32:05" color="">}}




{{<matomeQuote body="それ試してみたけど、tamperになってない別の端末でもシェル取れたんだよ。だからtamper状態は関係ないみたい。" userName="stgl" createdAt="2025/06/01 16:58:20" color="#785bff">}}




{{<matomeQuote body="えっ、tamper検知されないでRootシェル取れるってマジ？それはヤバすぎる…。" userName="numpad0" createdAt="2025/06/02 13:19:49" color="#ff5733">}}




{{<matomeQuote body="記事でドリルなしでポートにアクセスできるって書いてあったと思うよ！" userName="fp64" createdAt="2025/06/02 18:36:31" color="">}}




{{<matomeQuote body="俺もそう思ったんだ、新しいキーをフラッシュしてまた使えるかもって？<br>でもどんなキー使うんだよ？新しいキーで暗号化しても相手は復号できないし、意味なくない？" userName="lelanthran" createdAt="2025/06/01 19:05:45" color="">}}




{{<matomeQuote body="すぐ興奮しちゃう人向けに、記事で書いてたのはね、Rootシェルがあっても思ったよりヤバくないってこと。<br>カード情報みたいな大事なデータがこれで盗まれた証拠はないんだって。<br>セキュリティ設計者には勉強になる記事だね。" userName="mrbluecoat" createdAt="2025/06/01 15:02:52" color="#ff33a1">}}




{{<matomeQuote body="物理的に端末に触れてRoot権限があるのに、クレジットカード番号が読めないなんて絶対ありえないと思う。<br>セキュリティの世界では、物理アクセスはRootアクセスと同じくらい、ハック確実ってことだから。" userName="LunaSea" createdAt="2025/06/01 16:31:28" color="#ff5733">}}




{{<matomeQuote body="だから最新のチップカードとかタップ決済は、敏感な番号を全く公開しないんだよね。<br>カードリーダーは存在しない番号を盗めない。<br>磁気ストライプカードだけがそんなに安全じゃないけど、ここで悪用されたカードリーダーには磁気ストライプリーダーすらないんだ。<br>とはいえ、完璧なセキュリティじゃないよ。<br>チップ/タップカードがリーダーと接触中は、不正な目的で使われる可能性はある。<br>物理アクセスは、カード自体のセキュリティを破ったり、カードを撮るカメラを設置したり、他の悪用につながる扉を開けることもあるんだ。" userName="kbolino" createdAt="2025/06/01 16:49:39" color="">}}




{{<matomeQuote body="このカードリーダーには磁気ストライプリーダーがないって？いや、あるよ。<br>端末の右側だよ。<br>https://worldline.com/content/dam/worldline/local/sl-si/docu...<br>ここで確認できるよ。" userName="Tijdreiziger" createdAt="2025/06/01 21:15:42" color="#ff5c5c">}}




{{<matomeQuote body="よく見つけたね、記事の写真見ても（普通のシンボルも）気づかなかった。<br>理想的には、こういうストライプの使用は完全に排除されるべきだね、安全にはできないから。" userName="kbolino" createdAt="2025/06/01 22:31:46" color="">}}




{{<matomeQuote body="磁気ストライプは2027年に消え始めて、2029年にはなくなる予定だよ。<br>チップに磁気ストライプ情報が含まれてた印象だけど、展開が進むときにはなくなったと期待してる。<br>もうすでに、磁気ストライプ取引のリスクは店側が負うことになってるんだ。" userName="ianburrell" createdAt="2025/06/02 03:52:53" color="#38d3d3">}}




{{<matomeQuote body="EMV接触標準では、SDA（Static Application Data）へのフォールバックを許可してるみたいだね。<br>SDAは全然変わらない静的なデータで、偽造カードにかなり簡単にクローンできる。<br>それが磁気ストライプにエンコードされてるデータと同じかは分からないけど、大して良くない。<br>ハッキングされたカードリーダーは、SDAだけをサポートするフリをしてこれを悪用できるかもね。<br>でも、カード側がSDAをサポートしないことでこれを軽減できるんだ。" userName="kbolino" createdAt="2025/06/02 05:19:33" color="#45d325">}}




{{<matomeQuote body="銀行はSDA取引のリスクを加盟店に押し付けて影響を減らせるんだって。<br>データがスキミングされてカードが悪用されても、発行者はチャージバック手数料で儲かるからね…" userName="tgsovlerkhgsel" createdAt="2025/06/02 09:35:11" color="">}}




{{<matomeQuote body="UKでチップアンドピンが始まったのは2006年。<br>まさかまだこんな古いのが使われてるなんてびっくりだね。" userName="_joel" createdAt="2025/06/02 07:59:03" color="">}}




{{<matomeQuote body="導入は2004年で、2006年に義務化されたんだ。<br>フランスはもっと早くて、1992年からチップカードを使ってたらしいよ（前の規格だけどね）。" userName="Symbiote" createdAt="2025/06/02 13:33:44" color="">}}




{{<matomeQuote body="お店でまだ磁気リーダーを見ることはあるけど、支払いにじゃなくてバウチャーとかポイントカード、返金スキャン用に使われてるな。<br>支払いではもう使わないね。" userName="ChocolateGod" createdAt="2025/06/01 22:41:04" color="">}}




{{<matomeQuote body="オランダではバウチャーやポイントカードを決済端末で見たことないな。<br>いつもバーコードを店員か自分でスキャンするんだ。<br>返金はチップか非接触でやるよ。" userName="Tijdreiziger" createdAt="2025/06/02 10:36:15" color="">}}




{{<matomeQuote body="”チップカードや非接触決済のような最新技術は、機密性の高い番号を一切公開しない。”って言うけど、<br>番号なしでどうやって取引内容を確認するんだろうね？" userName="zahlman" createdAt="2025/06/01 20:35:23" color="">}}




{{<matomeQuote body="銀行はカードの公開鍵、カードは秘密鍵を持ってるHSMなんだ。<br>銀行は公開鍵でカードの署名を検証できるよ。<br>端末は入力値でカードに署名させて、カードはパスワード間違いなら署名しないんだ。<br>銀行はさらに妥当かチェックするよ。" userName="ElectricalUnion" createdAt="2025/06/01 22:03:59" color="#785bff">}}




{{<matomeQuote body="”端末は入力値でカードに署名させる。”って言うけど、<br>ハッキングされた端末だと表示は1ドルなのに、実際には500ドルの取引署名をカードに要求できるのが問題だね。" userName="runeks" createdAt="2025/06/02 10:36:45" color="">}}




{{<matomeQuote body="もっと安全なら、カード本体に画面とPIN入力があればいいのにね。<br>端末が信用できるか分からないから。<br>悪意ある加盟店やMitMが画面表示をごまかしたり、完全に操作してる可能性もあるもんね。" userName="ElectricalUnion" createdAt="2025/06/03 00:30:28" color="#785bff">}}




{{<matomeQuote body="大事なのは、クレジットシステムは暗号技術だけじゃないってこと。<br>認証情報が取れなくなると、詐欺師はそこで取引するしかなくなるから、どこで問題が起きたか特定できるんだ。<br>悪質なお店は追放したり、端末を調べたりできるし、ブロックチェーンと違って不正な取引は取り消せるよ。" userName="kbolino" createdAt="2025/06/03 18:18:40" color="#ff5733">}}




{{<matomeQuote body="この端末が僕が扱ったのに似てるならね、rootシェル取れたデバイスは、カード情報を扱うのと”同じデバイス”なのは、筐体とか同じ基板にあるって意味だけだよ。それ以外は別のコンピューターなんだ。<br>僕の場合、”外側”のシステムはAndroidだったから、ADBで好きに操作できたんだ—セキュリティはゆるめだったよ。”セキュアボード”は決済の詳細を扱う部分だけ担当してた。<br>決済フローをテストするために、結局3Dプリンターを改造してスタイラスを持たせることにしたんだ。Androidの組み込みツールだと、セキュアボードがやってることは”Xドルで決済開始”、”ユーザーがキャンセル”、”Xドル決済完了”みたいな限定されたアクション以外、何も見えなかったし触れなかったからね。" userName="__MatrixMan__" createdAt="2025/06/01 22:13:54" color="#ff33a1">}}




{{<matomeQuote body="セキュアファームウェアを起動するか、改ざん画面に行くか決めるバイナリを見てみたら？おそらく、パッチすればセキュアファームウェアを動かして、もっと調べられるのが簡単だと思うよ。<br>Linuxシステムの目的がネットワーキングとアップデートなら、セキュア部分のファームウェアをアップデートする方法があるってことだよね。それは理想的じゃないな。<br>改ざんチェックがLinuxのユーザーランドにあるなら、そのファームウェアアップデートはすごく怪しいと思うよ。" userName="emidln" createdAt="2025/06/02 04:55:43" color="#ff5733">}}




{{<matomeQuote body="起動するか改ざんモードに行くか決めるバイナリは”loadercode”だよ。これは完全性が保護されてる（多分Boot ROMか何かで）。<br>セキュアファームウェアはアップデートできるけど、それも署名されてるんだ。" userName="stgl" createdAt="2025/06/02 05:31:40" color="">}}

{{</details>}}




{{< details summary="もっとコメントを表示（2）">}}

{{<matomeQuote body="もし完全性保護がTPMの実装みたいなら、メモリにロードされた後は適用されないことが多いんだ。最初にロードされた時だけ、それ以前のものも含めて証明されたってだけ。<br>これはユーザーランドに入るとすごく重要になるよ。特に古いシステムなら、適当な既製のExploitを連鎖させて、loadercodeとか何かのbinfmtローダーを修正するつもりでカーネルメモリを変更できるんだ。<br>もちろん、loadercodeがセキュアファームウェアを呼び出す薄いシムで、改ざんモードがディスプレイを制御する別のファームウェアじゃなくてセキュアファームウェア側にあるなら、あまり先に進めないだろうね。<br>要するにね、すごく古いLinuxディストリビューションのrootファイルシステムを制御できるなら、Linuxバイナリ自体の他のセキュリティ対策はあまり意味ないんじゃないかって懐疑的なんだ。" userName="emidln" createdAt="2025/06/02 06:02:13" color="#ff5733">}}




{{<matomeQuote body="Linuxはどんなセキュアなバイナリも扱わないよ。署名されて暗号化されたセキュアイメージが置かれてるファイルシステムを共有してるだけなんだ。<br>loadercodeの検証はLinuxではやらないよ。むしろ、非セキュアなブートローダーがファイルシステムからそれを読み込んで、どこかのメモリアドレスにロードするだけ。そこから、完全性がチェック（？）されて、第2のセキュアコアで実行されるんだ。これがセキュアイメージを検証してチェーンロードするんだよ。" userName="stgl" createdAt="2025/06/02 06:08:45" color="#ff5c5c">}}




{{<matomeQuote body="それは設定次第だよ。マスターカードとVisaのデビットとクレジットに、実際のプロトコルの違いはあまりないんだ。<br>ベルギーのDelhaizeもこれを使ってるけど、間違いなくあらゆる種類のクレジットカード（少なくともVisa、MasterCard、さらにはAmExも）で使えるよ。" userName="Ambroos" createdAt="2025/06/01 20:47:52" color="">}}




{{<matomeQuote body="記事を読んでよ。実際の作業は、署名されたイメージだけを実行する別のプロセッサがやってるんだ。" userName="IshKebab" createdAt="2025/06/01 17:39:08" color="">}}




{{<matomeQuote body="（侵害された）Linuxが”侵害モード”のコードをロードするか、mp1セキュアシステムをロードするか決める？それは探るべき道筋のように聞こえるね。<br>ブートローダー自体はセキュアだって書いてあるけど、侵害された環境にロードされて実行される場所次第では、それはあまり意味ないかもしれないね。<br>コプロセッサはSecure Enclaveみたいなものと見なせるかもしれないけど、Linuxが別のブートローダーを（どうにかして）ロードして実行できるっていうのは懸念材料だよ。" userName="ComputerGuru" createdAt="2025/06/01 15:46:50" color="#38d3d3">}}




{{<matomeQuote body="いや、別のブートローダーは読み込めないよ。<br>セキュアブートローダー（loadercode）をいじろうとしたけど、起動しなかったんだ。<br>だから、ブートROMみたいなサードパーティが検証してるんだと思う。<br>あと、Linuxはタンパー状態に関係なくloadercodeとmp1.imgを常に読み込むと思う。<br>タンパー状態による異なるコードパスは、保護されたloadercode内で実行されるんだよ。" userName="stgl" createdAt="2025/06/01 16:29:01" color="">}}




{{<matomeQuote body="外部デバッグインターフェースを使ったら、タンパーモードは設定されないってことを覚えておいてね。<br>もしLinuxがネットワーキングに使われているなら、決済をMITMできるかもしれない。" userName="ComputerGuru" createdAt="2025/06/01 16:59:00" color="#ff5c5c">}}




{{<matomeQuote body="カードの詳細と支払いは暗号化されてから、セキュア／トラステッドゾーンで実行されているファームウェアによって、アクワイアラーから提供された公開鍵を使って署名されるんだよ。" userName="_djo_" createdAt="2025/06/01 21:17:11" color="">}}




{{<matomeQuote body="イージーモードで試したいなら、ああいう新顔のAndroidベースのクレジットカード端末をチェックしてみて。<br>画面にPINをタップするから、はるかに「美味しい」と思うよ。ジューシーだね。" userName="halpow" createdAt="2025/06/01 15:18:14" color="">}}




{{<matomeQuote body="タッチコントローラーは普通、セキュリティプロセッサで制御されるMUXに接続されてる。<br>PIN／PANsのような機密データを入力する時は、タッチコントローラーの出力はセキュリティプロセッサに直結されて、GUIを担当するAndroid由来のOSは迂回されるんだ。" userName="bmurray7jhu" createdAt="2025/06/01 21:08:50" color="#785bff">}}




{{<matomeQuote body="そしてユーザーとして、これと、全てのセキュア機能が取り除かれてランダムなAndroidが動いてて、NFCやChipのデータを本物のリーダーにプロキシしつつ、私のPINは人間がリアルタイムで本物のリーダーに手入力してるようなデバイスとを区別する方法は全くない。<br>私が気づくのは、1秒かそこらの遅延だけだね。" userName="tgsovlerkhgsel" createdAt="2025/06/02 09:38:19" color="">}}




{{<matomeQuote body="物理ボタンの端末が安全だってどうやって確認するの？タッチスクリーンだからって本質的に安全じゃなくなるわけじゃないと思う。<br>俺の理解では、システム全体はリプレイ攻撃を無効にするよう設計されてるよ。<br>PIN単体じゃ取引できないし、リーダーとカードの記録されたやり取りと組み合わせてもダメ。<br>カードのChipにある秘密鍵を使った非対称暗号が関係してて、署名にはランダムなnonceが含まれてるんだ。" userName="grishka" createdAt="2025/06/02 17:18:44" color="">}}




{{<matomeQuote body="PINと磁気ストライプデータだけでも（Chipからの1回読み取りで複製できると思う）、一部のケースでは支払いするのに十分なんだ。<br>もし合法的な端末タイプが十分に少なくてユーザーがそれを知っていれば、違う端末を提示されたら怪しまれるだろうね。<br>現状では、カード所有者である俺としては、誰かの自家製スキマーに見えたとしても、提示されたものがおそらく合法だと仮定せざるを得ない。<br>ただし、これはまだ加盟店を残してる。彼ら（端末を渡してくる人）が詐欺に関与してないなら、どんな改ざんも彼らに非自明である必要がある。<br>AFAIK、デバイスの重さを量ったり、シールやシリアル番号を定期的にチェックしたりするところもあるらしい。VISAは1日2回のチェックを推奨してるよ: https://busfin.colostate.edu/Forms/Merchant_Svcs/Visa_Securi...<br>物理ボタンの端末を改ざんしようとすると、物理的に配線を変える必要があって、タンパー検知が作動して端末が使えなくなるだろうね。<br>だから、改ざんされたけど見た目は全く同じで、怪しまれない程度には機能するユニットと交換する必要があるだろう。<br>攻撃者はケースをくり抜いて完全にカスタムの電子機器を入れることも、理論的には可能だけど、それはかなり高いハードルだね（特にシリアル化されたシールの偽造が必要なら）。<br>安全じゃないAndroidを搭載したタッチスクリーン端末の場合、安全じゃない側でのソフトウェア変更だけで（PIN入力モードを実際には開始しないとか、最初の試行と「PINが間違ってる」メッセージの後だけ開始するとか）、PINを取得するのに十分であるべきだし、他の電子機器に接続されてないNFCスキマーを追加すれば残りはできるだろうね。<br>そのデバイスも安っぽく見えて、少量しか流通してないし、最も一般的な端末ほど多くの耐タンパー機能があるか疑わしいけど、俺が間違ってるかもしれない。<br>もし強力な物理的な耐タンパー対策があって、ソフトウェアがソフトウェアベースの改ざんに対して強化されてるなら、理論的には同程度に安全になりうると思う。" userName="tgsovlerkhgsel" createdAt="2025/06/02 18:52:01" color="#ff33a1">}}




{{<matomeQuote body="磁気ストライプは米国でしか人気がないみたいだね。<br>あそこのカード決済がいかに安全じゃないかにはいつもびっくりする。<br>数ドルの少額決済だと、POSシステムについたリーダーにカードをスワイプするだけで終わり。<br>PINコードも何もなしで、数秒後にカードに請求があったっていうSMSが来るだけ。<br>より高額な決済だと、「レシートにサイン」とか「ID見せて」みたいな完全に人間頼みの確認方法を使う。<br>米国に行くまでこんなことになってるとは知らなかったよ。<br>俺の出身のロシアでは、もう10年以上カードをスワイプしてない。<br>最近は多くの場所で、磁気ストライプリリーダーすらない、NFCとChipだけの四角いAndroidベースのSberbank端末が出てきた。<br>まあ、俺たちの銀行システムは2022年から世界のほとんどから事実上切り離されてるけど、これらがMasterCardやVisaが戻ってきた時の要求に応じられるように設計されてないとしたら驚きだね。<br>そしてスキマーは、ここじゃもはや存在しない。<br>代わりにソーシャルエンジニアリングを通じて詐欺に遭うんだ。<br>磁気ストライプの取引は、静的で簡単にコピーできるデータしか必要としないためにリスクが高いから、加盟店の手数料がもっとかかる、みたいな記事も読んだ気がするな。<br>とにかく、俺が言いたいのは、静的データで取引ができなくなると、脅威モデルが変わって、ずっとシンプルになるってことだよ。<br>詐欺師が何を捕まえようと、たとえPINとNFCやChipリーダー経由のカードとの完全なデータ交換だったとしても、それを使って取引することはできないからね。<br>番号、有効期限、CVCだけを手に入れても、オンライン取引ができる可能性も低い。<br>今は2段階認証が必要だからね。Amazon以外はね。<br>Amazonはなぜか番号と日付だけでカードに請求できるんだ。CVCもいらないし、2faコードも必要ない。" userName="grishka" createdAt="2025/06/02 23:12:56" color="#45d325">}}




{{<matomeQuote body="もう少し考えたけど、いや、タッチスクリーンに関する君の議論は意味をなさないね。<br>OPが見た端末は「安全じゃない」側でLinuxが動いてるけど、物理キーパッドもメニューや金額入力に使われるから、Android SoCにタッチスクリーンが渡されるのと同じようにそっちに渡されるはずだよ。<br>Linux側は「セキュア」OSを動かすCPUコアにPIN入力開始のコマンドを送る必要があって、それは君が説明したとおりにできる可能性がまだあるんだ。" userName="grishka" createdAt="2025/06/03 08:31:44" color="#785bff">}}




{{<matomeQuote body="PINデータはタッチパッドに表示されても、信頼できるゾーンのファームウェアで制御されるユーザーインターフェースを使って暗号化されてるから、Rootシェルでアクセスできるような中間アプリからはPINは見れないんだよ。" userName="_djo_" createdAt="2025/06/01 20:29:43" color="#38d3d3">}}




{{<matomeQuote body="それでPINはかなり簡単に手に入るだろうけど、もし同じように設計されてて（重要な部分は全部セキュアな二次プロセッサに渡されてる場合）、モダンなカードがこういうのを防ぐためにすごい暗号化をカード上でやってるなら、カードでできることはあんまりないだろうね。<br>磁気カードリーダー以外の支払い方法が全部壊れてる端末でしか攻撃は効かないだろうけど、そういうのはPIN入力を求められる前にスキマー警告アラームを出すはずだよ。" userName="jeroenhd" createdAt="2025/06/01 15:46:54" color="#ff5c5c">}}




{{<matomeQuote body="お宅の地域でどんなAndroid端末使ってるか知らないけど、インドではAndroid Oreo（2021年1月サポート終了）が動いてるみたいだよ。やばいね！" userName="user_7832" createdAt="2025/06/01 16:05:25" color="">}}




{{<matomeQuote body="あと、他のアプリを開けたり通知センターも開けたりするらしい。そして、当然だけどデバイス全体がひどく重いとさ。" userName="user_7832" createdAt="2025/06/01 16:06:42" color="">}}




{{<matomeQuote body="デバイスの改ざん検知（tamper detection）について読んでて、一番簡単な改ざんモードをトリガーする方法ってなんだろ？数台でそれをやれれば、支払いの大半―時には全部―がこれらを通る小売店にとっては効率的なサービス妨害（denial of service attack）になるよね。" userName="ttkari" createdAt="2025/06/02 09:15:41" color="#45d325">}}




{{<matomeQuote body="床に落とすか水をぶっかけるとかね。" userName="neop1x" createdAt="2025/06/02 13:09:34" color="">}}




{{<matomeQuote body="ブラボー！改ざん防止（tamper protection）みたいなハードウェア制限を悪用したり回避したりする方法を考えるの好きだよ。でも、トリガーされたらゲームオーバーだと思ってた。そうじゃないみたいで、まだ色々弄れる面白い部分が残ってるんだね。セキュアな部分がちゃんと無効になるのは理にかなってるけどね、じゃないと設計者を信用できなくなる。" userName="Liftyee" createdAt="2025/06/01 14:58:16" color="#ff5733">}}




{{<matomeQuote body="それはおそらく強化されたプロセッサについてはまだ言えることだろうね。TFA（記事）が指摘してるように、ここで侵害されたのはそこじゃないんだ。<br>テキスト文字列だけがバイナリ（display_tool）に渡されて、プロセッサ間のメッセージをいくつか発行するだけみたいだね。キーパッドやカードリーダー自体も同じ。<br>Linuxからこれらの周辺機器に直接アクセスできる証拠は見つけられなかったと。<br>代わりに、mp1と呼ばれる全く別のプロセッサがあって、カード処理、PIN取得、画面表示といった“secure”な処理全部を扱ってるみたい。<br>二番目のプロセッサmp2で動く“insecure”なLinuxは、ネットワーキング、アップデート、そしてビジネスロジックだけを扱ってるんだね。" userName="lxgr" createdAt="2025/06/01 15:01:13" color="#ff5733">}}




{{<matomeQuote body="説明によると、Linux側が改ざんイベントのハンドリングに何らかの役割を果たすかもしれないみたいだけど、それが起きたことを認識するだけだといいな。もしRootシェルを先に取得できれば、改ざんイベントによってセキュリティキーが消去されるのを防ぐ機会につながる可能性があるからね。" userName="fredthestair" createdAt="2025/06/01 15:16:38" color="#ff5733">}}




{{<matomeQuote body="こういうのを調べるのはいいね…でも、なんでいきなり開けて改ざん状態をトリガーしたんだ？ほとんどのリーダーにそれがあるの知らなかったのかな？改ざん状態で行われる実際のテストは無意味かもしれない。Rootシェルはリセット目的で改ざん状態がトリガーされた後も使えるのかもしれないけど。とにかく、開けるのは最後に試すことのように思えるけどね。" userName="ofjcihen" createdAt="2025/06/01 16:37:32" color="#ff33a1">}}

{{</details>}}



[記事一覧へ]({{% ref "/posts/" %}})
